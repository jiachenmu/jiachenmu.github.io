<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ManoBoo的技术小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ManoBoo的技术博客，以后文章会和简书同步更新~">
<meta property="og:type" content="website">
<meta property="og:title" content="ManoBoo的技术小窝">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ManoBoo的技术小窝">
<meta property="og:description" content="ManoBoo的技术博客，以后文章会和简书同步更新~">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ManoBoo的技术小窝">
<meta name="twitter:description" content="ManoBoo的技术博客，以后文章会和简书同步更新~">
  
    <link rel="alternative" href="/atom.xml" title="ManoBoo的技术小窝" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/avatar.png">
  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/avatar.png" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/">ManoBoo</a></h1>
        </hgroup>

        
        <p class="header-subtitle">欢迎来ManoBoo的小窝做客</p>
        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github" target="_blank" href="https://github.com/jiachenmu" title="github">github</a>
                            
                                <a class="fl Weibo" target="_blank" href="http://weibo.com/u/3484140182?is_all=1" title="Weibo">Weibo</a>
                            
                                <a class="fl NeteaseMusic" target="_blank" href="http://music.163.com/#/user/home?id=79418549" title="NeteaseMusic">NeteaseMusic</a>
                            
                                <a class="fl Jianshu" target="_blank" href="http://www.jianshu.com/users/232094594d02/latest_articles" title="Jianshu">Jianshu</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/CMModel-JSON转Model工具/" style="font-size: 10px;">CMModel JSON转Model工具</a> <a href="/tags/ReactiveCocoa/" style="font-size: 10px;">ReactiveCocoa</a> <a href="/tags/Swift2-0-高仿App-半塘/" style="font-size: 10px;">Swift2.0 高仿App 半塘</a> <a href="/tags/iOS-模仿-App/" style="font-size: 10px;">iOS 模仿 App</a> <a href="/tags/iOS小项目-App/" style="font-size: 20px;">iOS小项目 App</a>
                    </div>
                </section>
                
                
                

                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">iOS开发者，写代码是一件非常happy的事情😄</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">ManoBoo</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/avatar.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">ManoBoo</a></h1>
            </hgroup>
            
            <p class="header-subtitle">欢迎来ManoBoo的小窝做客</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="https://github.com/jiachenmu" title="github">github</a>
                    
                        <a class="Weibo" target="_blank" href="http://weibo.com/u/3484140182?is_all=1" title="Weibo">Weibo</a>
                    
                        <a class="NeteaseMusic" target="_blank" href="http://music.163.com/#/user/home?id=79418549" title="NeteaseMusic">NeteaseMusic</a>
                    
                        <a class="Jianshu" target="_blank" href="http://www.jianshu.com/users/232094594d02/latest_articles" title="Jianshu">Jianshu</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-iOS利用Runtime写一个Json转Model的工具" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/19/iOS利用Runtime写一个Json转Model的工具/" class="article-date">
      <time datetime="2016-07-19T09:43:05.000Z" itemprop="datePublished">2016-07-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/19/iOS利用Runtime写一个Json转Model的工具/">iOS利用Runtime写一个Json转Model的工具</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <hr>
<h2 id="前言"><a href="#前言" class="headerlink" title="#前言"></a>#前言</h2><h2 id="好久没有写过新文章了，最近一直在忙工作的事情，我的新浪微博开源项目也停止了一周时间，目前完成了60-，就先写一篇关于JSON转Model的文章和大家聊聊天吧，为什么会写一个这个小工具呢，请看文末😄"><a href="#好久没有写过新文章了，最近一直在忙工作的事情，我的新浪微博开源项目也停止了一周时间，目前完成了60-，就先写一篇关于JSON转Model的文章和大家聊聊天吧，为什么会写一个这个小工具呢，请看文末😄" class="headerlink" title="###好久没有写过新文章了，最近一直在忙工作的事情，我的新浪微博开源项目也停止了一周时间，目前完成了60%，就先写一篇关于JSON转Model的文章和大家聊聊天吧，为什么会写一个这个小工具呢，请看文末😄"></a>###好久没有写过新文章了，最近一直在忙工作的事情，我的新浪微博开源项目也停止了一周时间，目前完成了60%，就先写一篇关于JSON转Model的文章和大家聊聊天吧，为什么会写一个这个小工具呢，请看文末😄</h2><h2 id="核心方法Runtime的介绍"><a href="#核心方法Runtime的介绍" class="headerlink" title="#核心方法Runtime的介绍"></a>#核心方法Runtime的介绍</h2><p>##1. Runtime是什么？</p>
<p>顾名思义：Runtime就是运行时的意思，是系统在运行时的一些机制，其中最主要的就是消息机制，举个常用的例子，在面向对象编程的语言中，万物皆对象，对象如何调用方法呢，<br><code>[target excuteSEL]</code>,需要一个对象，需要一个方法名，系统在运行时会自动转换成以下的形式：<br><code>objc_msgSend(target,@selector(excuteSEL:))</code></p>
<p>关于Runtime的详细介绍，网上有很多，这里就不做过多描述了。</p>
<hr>
<p>##2.Runtime的常见用法<br>注:使用时需要<code>#import &lt;objc/objc-runtime.h&gt;</code></p>
<h3 id="1-方法替换-黑魔法"><a href="#1-方法替换-黑魔法" class="headerlink" title="* 1 方法替换(黑魔法)"></a>* 1 方法替换(黑魔法)</h3><p>举个例子来说明一下：<br>将调用A方法替换为调用B方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">class_replaceMethod([self class], @selector(sendAMessage:), (IMP)changeAtoB, NULL);</div><div class="line"></div><div class="line">//MARK: 方法替换_1</div><div class="line">- (void)sendAMessage:(NSString *)message &#123;</div><div class="line">    NSLog(@&quot;A_message: %@&quot;,message);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)sendBMessage:(NSString *)message &#123;</div><div class="line">    NSLog(@&quot;B_Message: %@&quot;,message);</div><div class="line">&#125;</div><div class="line"></div><div class="line">ViewController * changeAtoB(ViewController *SELF, SEL _cmd, NSString *message) &#123;</div><div class="line">   </div><div class="line">    if ([NSStringFromSelector(_cmd) isEqualToString:@&quot;sendAMessage:&quot;]) &#123;</div><div class="line">        //将方法进行替换</div><div class="line">        [SELF sendBMessage:message];</div><div class="line">    &#125;</div><div class="line">    return SELF;</div><div class="line">&#125;</div><div class="line">//这里IMP可以理解为魔法通道，将源方法通过IMP指针转换为目标方法</div></pre></td></tr></table></figure></p>
<h3 id="2-获取对象的属性和方法"><a href="#2-获取对象的属性和方法" class="headerlink" title="* 2 获取对象的属性和方法"></a>* 2 获取对象的属性和方法</h3><p>注：获取对象的属性，这个方法在JSON转Model可以说是核心方法了<br>举例说明：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//class_copyPropertyList 这个方法会获取到一个类.h和.m文件中interface中的所有属性</div><div class="line"></div><div class="line">//获取CMGCD类的属性名称</div><div class="line">    unsigned int count;</div><div class="line">    objc_property_t *propertyList = class_copyPropertyList([CMGCD class], &amp;count);</div><div class="line">    for (unsigned int i = 0; i &lt; count; i++) &#123;</div><div class="line">        const char *propertyName = property_getName(propertyList[i]);</div><div class="line">        NSLog(@&quot;property ---&gt; %@&quot;,[NSString stringWithUTF8String:propertyName]);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//</div><div class="line">unsigned int count;</div><div class="line">Method *methodList = class_copyMethodList([CMGCD class], &amp;count);</div><div class="line">    for (unsigned int i; i &lt; count; i++) &#123;</div><div class="line">        Method method = methodList[i];</div><div class="line">        NSLog(@&quot;Method ---&gt; %@&quot;,NSStringFromSelector(method_getName(method)));</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="2-设置对象关联"><a href="#2-设置对象关联" class="headerlink" title="* 2 设置对象关联"></a>* 2 设置对象关联</h3><p>定义：关联是指把两个对象相互关联起来，使其中的一个对象作为另外一个对象的一部分<br>再举个例子，我在对象中定义了一个属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@property (strong, nonatomic) NSString *content;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//设置对象属性关联</div><div class="line">static char associatedKey;</div><div class="line">    objc_setAssociatedObject(self, &amp;associatedKey, @&quot;content_yeah&quot;, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">    NSString *get_content = objc_getAssociatedObject(self, &amp;associatedKey);</div><div class="line">    NSLog(@&quot;content = %@&quot;,get_content);</div></pre></td></tr></table></figure>
<p><strong>Tips:</strong>设置对象关联需要以下几个要点：<br><code>源对象</code>、<code>关键字</code>、<code>关联的对象</code> <code>关联策略</code><br><strong>解释一下：</strong>这里我将<code>@&quot;content_yeah&quot;</code>这个对象与<code>self</code>使用<code>OBJC_ASSOCIATION_RETAIN_NONATOMIC</code>策略关联到一起，意思就是在<code>self</code>的生命周期之内关联的对象都不会被释放，通过这个方法，可以实现动态向类里面添加属性<br>另外还有一些关联的方法，如</p>
<ul>
<li><p>断开关联： 设置关联对象为<code>nil</code>即可<br><code>objc_setAssociatedObject(self, &amp;associatedKey, nil, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</code></p>
</li>
<li><p>断开这个对象的所有关联关系</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//断开所有关联</div><div class="line">    objc_removeAssociatedObjects(self);</div></pre></td></tr></table></figure>
<hr>
<p>#JSON转Model工具的主要介绍</p>
<hr>
<h2 id="1-为什么会写这样一个工具"><a href="#1-为什么会写这样一个工具" class="headerlink" title="1. 为什么会写这样一个工具"></a>1. 为什么会写这样一个工具</h2><p>很多时候我们并不是缺少实力，而且是缺少一种<strong><code>彼可取而代之</code></strong>的勇气，为什么会有<code>MJExtension</code>、<code>YYModel</code>的产生,查看源代码的过程中我有种想死的感觉，但是知道实现的原理后，为什么不能自己去实现一个呢？这个工具的源代码非常简单，我写这个工具的目的只是为了告诉朋友们，真的不复杂，不要因为看着复杂就放弃了自己动手的冲动</p>
<h2 id="2-工具的整体步骤简介"><a href="#2-工具的整体步骤简介" class="headerlink" title="2. 工具的整体步骤简介"></a>2. 工具的整体步骤简介</h2><p>着重介绍一下我的思考过程</p>
<ul>
<li>1 核心方法？<br> 利用Runtime可以遍历出对象的所有属性，然后利用递归的思想逐层解析JSON</li>
<li>2 怎么去做？<br> 基本所有的Model继承<code>NSObject</code>，我们可以写一个<code>NSObject</code>的<code>Category</code>，然后在其中写一些解析方法，我们需要一个对照JSON字符串的解析路径字典，比如说<code>JSON</code>的<code>狗</code>的属性名称为<code>dog</code>,我们的对象属性名称想定义为<code>xiaogou</code>，这就需要手写一个字典将解析中遇到的<code>dog</code>都给映射为<code>xiaogou</code></li>
<li>3 开始动手吧</li>
</ul>
<hr>
<h2 id="3-主要代码介绍："><a href="#3-主要代码介绍：" class="headerlink" title="3. 主要代码介绍："></a>3. 主要代码介绍：</h2><hr>
<h3 id="1-NSObject-CMModel-介绍"><a href="#1-NSObject-CMModel-介绍" class="headerlink" title="* 1 NSObject+CMModel 介绍"></a>* 1 <code>NSObject+CMModel</code> 介绍</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//NSObject+CMModel.h </div><div class="line">// 单个对象</div><div class="line">- (NSDictionary *)dict_CMModelWithClass;</div><div class="line"></div><div class="line">// 对象数组</div><div class="line">- (NSDictionary *)dict_CMModelWIthArrayClass;</div><div class="line"></div><div class="line">- (instancetype)cm_initWithJSONString:(NSString *)jsonString;</div></pre></td></tr></table></figure>
<p>下面着重解释一下.m文件中的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//NSObject+CMModel.m</div><div class="line">#import &lt;objc/runtime.h&gt;</div><div class="line">#import &quot;CMObject.h&quot;</div><div class="line">#import &quot;CMProperty.h&quot;</div><div class="line"></div><div class="line">//返回单个对象的解析字典，默认为nil</div><div class="line">- ( NSDictionary * _Nullable )dict_CMModelWithClass &#123;</div><div class="line">    return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//返回对象数组的解析字典，默认为nil</div><div class="line">- (NSDictionary *)dict_CMModelWIthArrayClass &#123;</div><div class="line">    return nil;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//调用方法</div><div class="line">- (instancetype)cm_initWithJSONString:(NSString *)jsonString &#123;</div><div class="line">    if (self) &#123;</div><div class="line">        [self analysisWitnJsonString:jsonString];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <strong>取得对象的所有属性及其对应的类型</strong><br> Tips: 这里自己写了一个类，将对象的属性及其名称封装到一个类型为<code>CMProperty</code>的数组</p>
<ul>
<li>1 <strong>CMProperty类简介</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//属性名称</div><div class="line">@property (strong, nonatomic) NSString *propertyName;</div><div class="line"></div><div class="line">//属性的类</div><div class="line">@property (strong, nonatomic) Class propertyClass;</div><div class="line"></div><div class="line">//是否基本类型</div><div class="line">@property (assign, nonatomic) BOOL isBasicType;</div></pre></td></tr></table></figure>
<ul>
<li>2 <strong>获取对象属性及其类型，并且将其封装为类型为<code>CMProperty</code>的数组</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"> //将该类的属性和对应的类型进行封装</div><div class="line">- (NSArray &lt;CMProperty *&gt; *)propertyArray &#123;</div><div class="line">    NSMutableArray *propertyArray = [NSMutableArray array];</div><div class="line">    </div><div class="line">    unsigned int count;</div><div class="line">    objc_property_t *propertyList = class_copyPropertyList([self class], &amp;count);</div><div class="line">    for (unsigned int i = 0; i &lt; count; i++) &#123;</div><div class="line">        CMProperty *property = [[CMProperty alloc] init];</div><div class="line">        property.propertyName = [NSString stringWithUTF8String:property_getName(propertyList[i])];</div><div class="line">        </div><div class="line">        NSString *attrs = @(property_getAttributes(propertyList[i]));</div><div class="line"></div><div class="line">        NSUInteger dotLoc = [attrs rangeOfString:@&quot;,&quot;].location;</div><div class="line">        NSString *propertyType = nil;</div><div class="line">        NSUInteger loc = 1;</div><div class="line">        if (dotLoc == NSNotFound) &#123; // 没有找到</div><div class="line">            propertyType = [attrs substringFromIndex:loc];</div><div class="line">        &#125;else &#123;</div><div class="line">            propertyType = [attrs substringWithRange:NSMakeRange(loc, dotLoc - loc)];</div><div class="line">            if ([propertyType isEqualToString:@&quot;Q&quot;]) &#123;</div><div class="line">                //基本类型</div><div class="line">                property.isBasicType = true;</div><div class="line">            &#125;else &#123;</div><div class="line">                propertyType = [propertyType substringWithRange:NSMakeRange(2, propertyType.length - 3)];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        property.propertyClass = NSClassFromString(propertyType);</div><div class="line">    </div><div class="line">        [propertyArray addObject:property];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    free(propertyList);</div><div class="line">    </div><div class="line">    return propertyArray;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>开始解析</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//进行解析</div><div class="line">- (void)analysisWitnJsonString:(NSString *)json &#123;</div><div class="line">    </div><div class="line">    //存在解析字典</div><div class="line">    if ([self dict_CMModelWithClass] != nil || [self dict_CMModelWIthArrayClass] != nil) &#123;</div><div class="line">        CMObject *analysisTools = [[CMObject alloc] initWithGoalObject:self CMPropertyArray:[self propertyArray]];</div><div class="line">        if ([self dict_CMModelWIthArrayClass]) &#123;</div><div class="line">            analysisTools.analysisObjectArrayDict = [self dict_CMModelWIthArrayClass];</div><div class="line">        &#125;</div><div class="line">        if ([self dict_CMModelWithClass]) &#123;</div><div class="line">            analysisTools.analysisDict = [self dict_CMModelWithClass];</div><div class="line">        &#125;</div><div class="line">        analysisTools.jsonString = json;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="2-CMObject-介绍"><a href="#2-CMObject-介绍" class="headerlink" title="* 2 CMObject 介绍"></a>* 2 <code>CMObject</code> 介绍</h3><p>这个类为实际进行解析工具的类，或者可以称之为工具,这里我们需要特殊对待<code>NSArray</code>、<code>NSDictionary</code>、<code>int、float等基本类型</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//CMObject.h</div><div class="line"></div><div class="line">//要解析的对象</div><div class="line">@property (strong, nonatomic) id object;</div><div class="line"></div><div class="line">//解析key对应列表 单个对象</div><div class="line">@property (strong, nonatomic) NSDictionary *analysisDict;</div><div class="line"></div><div class="line">//解析key对应列表 对象数组</div><div class="line">@property (strong, nonatomic) NSDictionary *analysisObjectArrayDict;</div><div class="line"></div><div class="line">//属性列表</div><div class="line">@property (strong, nonatomic) NSArray &lt;CMProperty *&gt; *propertyArray;</div><div class="line"></div><div class="line">//init方法</div><div class="line">- (instancetype)initWithGoalObject:(id)object CMPropertyArray:(NSArray &lt;CMProperty *&gt; *)propertyArray;</div><div class="line"></div><div class="line">//解析的源JSON</div><div class="line">@property (strong, nonatomic) NSString *jsonString;</div><div class="line"></div><div class="line"></div><div class="line">BOOL Exist_(id obj,NSArray *existArray);</div></pre></td></tr></table></figure>
<p><strong>Tips:</strong> 下面代码可能看着会不舒服，我说一下整体的思路</p>
<h4 id="1-NSObject-CMModel中将封装的属性数组传递过来，我们一个接一个的对属性进行遍历构造"><a href="#1-NSObject-CMModel中将封装的属性数组传递过来，我们一个接一个的对属性进行遍历构造" class="headerlink" title="* 1 NSObject+CMModel中将封装的属性数组传递过来，我们一个接一个的对属性进行遍历构造"></a>* 1 <code>NSObject+CMModel</code>中将封装的属性数组传递过来，我们一个接一个的对属性进行遍历构造</h4><h4 id="2-遍历详解：举例，碰到NSArray的属性时，我们去看要解析的类中实现的-NSDictionary-dict-CMModelWIthArrayClass这个方法，找到目的对象的类型OBJClass，然后将JSON字典拆分后利用-instancetype-cm-initWithJSONString-NSString-jsonString这个方法创建一个OBJClass类型的对象，并且添加到数组中，创建完后，使用KVC-将数组赋给源对象，具体代码看下面"><a href="#2-遍历详解：举例，碰到NSArray的属性时，我们去看要解析的类中实现的-NSDictionary-dict-CMModelWIthArrayClass这个方法，找到目的对象的类型OBJClass，然后将JSON字典拆分后利用-instancetype-cm-initWithJSONString-NSString-jsonString这个方法创建一个OBJClass类型的对象，并且添加到数组中，创建完后，使用KVC-将数组赋给源对象，具体代码看下面" class="headerlink" title=" 2 遍历详解：举例，碰到NSArray的属性时，我们去看要解析的类中实现的`- (NSDictionary )dict_CMModelWIthArrayClass这个方法，找到目的对象的类型OBJClass，然后将JSON字典拆分后利用- (instancetype)cm_initWithJSONString:(NSString *)jsonString这个方法创建一个OBJClass类型的对象，并且添加到数组中，创建完后，使用KVC`将数组赋给源对象，具体代码看下面"></a><em> 2 遍历详解：举例，碰到<code>NSArray</code>的属性时，我们去看要解析的类中实现的`- (NSDictionary </em>)dict_CMModelWIthArrayClass<code>这个方法，找到目的对象的类型</code>OBJClass<code>，然后将</code>JSON字典<code>拆分后利用</code>- (instancetype)cm_initWithJSONString:(NSString *)jsonString<code>这个方法创建一个</code>OBJClass<code>类型的对象，并且添加到数组中，创建完后，使用</code>KVC`将数组赋给源对象，具体代码看下面</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">//CMObject.m</div><div class="line">//这里说一下解析方法, 代码较多</div><div class="line">//开始进行model解析</div><div class="line">- (void)analysisModel &#123;</div><div class="line">    NSDictionary *jsonDict = [NSJSONSerialization JSONObjectWithData:[_jsonString dataUsingEncoding:NSUTF8StringEncoding] options:NSJSONReadingAllowFragments error:nil];</div><div class="line"></div><div class="line">    //将`NSObject+CMModel`中获取的属性数组进行遍历构造，并赋值给对应的属性</div><div class="line">    [_propertyArray enumerateObjectsUsingBlock:^(CMProperty * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</div><div class="line">        //单独处理数组类型</div><div class="line">        if (obj.propertyClass == [NSArray class]) &#123;</div><div class="line">            //  对象为数组类型，</div><div class="line">            NSString *key = [_analysisObjectArrayDict objectForKey:obj.propertyName];</div><div class="line"></div><div class="line">            Class OBJClass = NSClassFromString(key);</div><div class="line">        </div><div class="line">            if (![jsonDict objectForKey:key]) &#123;</div><div class="line">                //名称与json中的名称并不相符</div><div class="line">                if ([_analysisDict objectForKey:obj.propertyName]) &#123;</div><div class="line">                    NSMutableArray *objectArray = [NSMutableArray array];</div><div class="line">                    </div><div class="line">                    NSArray *obj_json_array = [jsonDict objectForKey:[_analysisDict objectForKey:obj.propertyName]];</div><div class="line">                    [obj_json_array enumerateObjectsUsingBlock:^(NSDictionary   * _Nonnull obj_dict, NSUInteger idx, BOOL * _Nonnull stop) &#123;</div><div class="line">                        id objx = [[OBJClass alloc] cm_initWithJSONString:DataToJSONString(obj_dict)];</div><div class="line">                        //解析好对象之后，存到数据中</div><div class="line">                        [objectArray addObject:objx];</div><div class="line">                        </div><div class="line">                    &#125;];</div><div class="line">                    [_object setValue:objectArray forKey:obj.propertyName];</div><div class="line">                &#125;else &#123;</div><div class="line">                    </div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;else if (Exist_(obj.propertyClass, @[[NSDictionary class],[NSMutableDictionary class]])) &#123;</div><div class="line">            NSDictionary *obj_dict = [jsonDict valueForKey:[_analysisDict objectForKey:obj.propertyName]];</div><div class="line">            if (!obj_dict) &#123;</div><div class="line">                [_object setValue:[NSNull null] forKey:obj.propertyName];</div><div class="line">            &#125;else &#123;</div><div class="line">                [_object setValue:obj_dict forKey:obj.propertyName];</div><div class="line">            &#125;</div><div class="line">        &#125;else if (obj.isBasicType)&#123;</div><div class="line">            //基本类型</div><div class="line">            id num = [jsonDict valueForKey:[_analysisDict objectForKey:obj.propertyName]];</div><div class="line">            if (!num || num == [NSNull null]) &#123;</div><div class="line">                //为空判断</div><div class="line">                //这里我们默认设置为 0.00大小的NSNumber对象 </div><div class="line">                [_object setValue:NULL_NUM forKey:obj.propertyName];</div><div class="line">            &#125;else &#123;</div><div class="line">                NSNumber *number = (NSNumber *)num;</div><div class="line">                [_object setValue:number forKey:obj.propertyName];</div><div class="line">            &#125;</div><div class="line">        &#125;else &#123;</div><div class="line">            Class OBJClass = obj.propertyClass;</div><div class="line">            if(!Exist_(OBJClass, foundationClasses_)) &#123;</div><div class="line">                //如果类型为自定义类</div><div class="line">                id obj_dict = [jsonDict valueForKey:[_analysisDict objectForKey:obj.propertyName]];</div><div class="line">                //非空判断</div><div class="line">                if (!obj_dict) &#123;</div><div class="line">                    id objx = [[OBJClass alloc] cm_initWithJSONString:DataToJSONString(obj_dict)];</div><div class="line">                    [_object setValue:objx forKey:obj.propertyName];</div><div class="line">                &#125;else &#123;</div><div class="line">                    //这里可以赋值为[NSNull null] 可以赋值为一个新对象</div><div class="line">//                    [_object setValue:[NSNull null] forKey:obj.propertyName];</div><div class="line">                    [_object setValue:[[OBJClass alloc] init] forKey:obj.propertyName];</div><div class="line">                &#125;</div><div class="line">            &#125;else &#123;</div><div class="line">                [_object setValue:[jsonDict valueForKey:[_analysisDict objectForKey:obj.propertyName]] forKey:obj.propertyName];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="4-如何使用"><a href="#4-如何使用" class="headerlink" title="4. 如何使用"></a>4. 如何使用</h2><hr>
<p>举例说明：<br>这里有三个类<br><strong>Animals(动物)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@property (strong, nonatomic) NSArray &lt;Dog *&gt; *dogs;</div><div class="line">@property (strong, nonatomic) NSArray &lt;Pig *&gt; *pigs;</div></pre></td></tr></table></figure></p>
<p>—实现方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (NSDictionary *)dict_CMModelWithClass &#123;</div><div class="line">    return @&#123;</div><div class="line">             @&quot;dogs&quot; : @&quot;dog&quot;,</div><div class="line">             @&quot;pigs&quot; : @&quot;pig&quot;,</div><div class="line">             &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSDictionary *)dict_CMModelWIthArrayClass &#123;</div><div class="line">    return @&#123;</div><div class="line">             @&quot;dogs&quot; : @&quot;Dog&quot;,</div><div class="line">             @&quot;pigs&quot; : @&quot;Pig&quot;,</div><div class="line">             &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Dog(狗)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@property (strong, nonatomic) NSString *dog_name;</div><div class="line">@property (assign, nonatomic) NSUInteger dog_age;</div><div class="line"></div><div class="line">//狗养的猪</div><div class="line">@property (strong, nonatomic) Pig *dog_pig;</div></pre></td></tr></table></figure></p>
<p>—实现方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (NSDictionary *)dict_CMModelWithClass &#123;</div><div class="line">    return @&#123;</div><div class="line">             @&quot;dog_age&quot; : @&quot;age&quot;,</div><div class="line">             @&quot;dog_name&quot; : @&quot;name&quot;,</div><div class="line">             @&quot;dog_pig&quot; : @&quot;dog_pig&quot;</div><div class="line">             &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Pig(猪)</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@property (strong, nonatomic) NSString *pig_name;</div><div class="line">@property (assign, nonatomic) NSUInteger pig_age;</div></pre></td></tr></table></figure></p>
<p>—实现方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (NSDictionary *)dict_CMModelWithClass &#123;</div><div class="line">    return @&#123;</div><div class="line">             @&quot;pig_age&quot; : @&quot;age&quot;,</div><div class="line">             @&quot;pig_name&quot; : @&quot;name&quot;</div><div class="line">             &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>调用方法</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSString *testJSON = @&quot;&#123;\&quot;dog\&quot;:[&#123;\&quot;name\&quot;:\&quot;dog_1\&quot;,\&quot;age\&quot;:15,\&quot;dog_pig\&quot;:&#123;\&quot;name\&quot;:\&quot;dogAndPig1\&quot;,\&quot;age\&quot;:666&#125;&#125;,&#123;\&quot;name\&quot;:\&quot;dog_2\&quot;,\&quot;age\&quot;:null,\&quot;dog_pig\&quot;:null&#125;],\&quot;pig\&quot;:[&#123;\&quot;name\&quot;:\&quot;pig_1\&quot;,\&quot;age\&quot;:10&#125;,&#123;\&quot;name\&quot;:\&quot;pig_2\&quot;,\&quot;age\&quot;:12&#125;]&#125;&quot;;</div><div class="line"></div><div class="line">Animals *animals = [[Animals alloc] cm_initWithJSONString:testJSON];</div></pre></td></tr></table></figure></p>
<p>#写在后面的话<br>这个项目并不完善，比如说对于其中日期的格式化，非空的一些判断等，其中也有一些bug，本文权当是抛砖引玉，利用<code>Runtime</code>可以做很多事情，比如你可以实现，一句话完成归档与解归档，不会再出现Model属性过多时重写<code>initWithCoder</code>和<code>encodeWithCoder</code>的尴尬了，so，有时候我们更缺的是一种思考问题的方式，共勉！</p>
<p>PS：欢迎来我的简书、Github、个人博客交流😄</p>
<blockquote>
<p><a href="https://github.com/jiachenmu/JSONTOModel" target="_blank" rel="external">文中的Demo下载地址</a></p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CMModel-JSON转Model工具/">CMModel JSON转Model工具</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iOS-Reactive-Cocoa使用浅析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/04/iOS-Reactive-Cocoa使用浅析/" class="article-date">
      <time datetime="2016-07-04T01:34:44.000Z" itemprop="datePublished">2016-07-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/04/iOS-Reactive-Cocoa使用浅析/">iOS Reactive Cocoa使用浅析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="iOS-Reactive-Cocoa使用浅析"><a href="#iOS-Reactive-Cocoa使用浅析" class="headerlink" title="iOS Reactive Cocoa使用浅析"></a>iOS Reactive Cocoa使用浅析</h1><p>标签（空格分隔）： ReactiveCocoa简单使用</p>
<hr>
<p>##<strong>目录：</strong></p>
<p>[TOC]</p>
<p>##Reactive Cocoa浅析</p>
<blockquote>
<p>ReactiveCocoa是响应式编程(FRP)在IOS中的一个实现框架,<a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external">Github地址</a></p>
</blockquote>
<p>###1.什么是响应式编程<br>推荐一个网址<a href="http://www.tuicool.com/articles/BBNRRf" target="_blank" rel="external">响应式编程（Reactive Programming）介绍</a>,如果不太清楚，那么我们首先来了解一下其他的编程思想</p>
<p>####1.面向过程：</p>
<blockquote>
<p>“面向过程”(Procedure Oriented)是一种以过程为中心的编程思想。“面向过程”也可称之为“面向记录”编程思想，他们不支持丰富的“面向对象”特性（比如继承、多态），并且它们不允许混合持久化状态和域逻辑。</p>
</blockquote>
<p>C语言就是一门面向过程的语言。</p>
<p>####2.面向对象</p>
<blockquote>
<p>面向对象语言（Object-Oriented Language）是一类以对象作为基本程序结构单位的程序设计语言，指用于描述的设计是以对象为核心，而对象是程序运行时刻的基本成分。语言中提供了类、继承等成分。</p>
<p>万物皆对象</p>
</blockquote>
<p>典型的面向对象的编程语言有C++,C#,Java等 </p>
<p>####3.链式编程</p>
<blockquote>
<p>是将多个操作（多行代码）通过点号(.)链接在一起成为一句代码,使代码可读性好<br>在<code>Objective-C</code>中的形式类似于下面这种形式</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Person *per = [[Person allo] init];</div><div class="line">per.eat().drink().sleep();</div></pre></td></tr></table></figure>
<p><strong>用一个<a href="https://github.com/jiachenmu/ReactiveCocoaDemo" target="_blank" rel="external">计算器Demo</a>来简单说明什么是链式编程</strong><br>这是我写的一个非常简单的计算器<br><strong>Calculator.h</strong>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@class Calculator;</div><div class="line">typedef Calculator *(^CalculatorBlock)(double num);</div><div class="line"></div><div class="line">@interface Calculator : NSObject</div><div class="line"></div><div class="line">+ (instancetype)opeartionNum:(double)num;</div><div class="line"></div><div class="line">@property (assign, nonatomic) double opeartionNum;</div><div class="line"></div><div class="line">//加--减--乘--除</div><div class="line"></div><div class="line">@property (copy, nonatomic) CalculatorBlock add;</div><div class="line">@property (copy, nonatomic) CalculatorBlock reduce;</div><div class="line">@property (copy, nonatomic) CalculatorBlock multiply;</div><div class="line">@property (copy, nonatomic) CalculatorBlock divide;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p><strong>Calculator.m</strong>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">#import &quot;Calculator.h&quot;</div><div class="line"></div><div class="line">@implementation Calculator</div><div class="line"></div><div class="line">- (instancetype)init</div><div class="line">&#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        [self buildBlock];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (instancetype)opeartionNum:(double)num &#123;</div><div class="line">    Calculator *calu = [[Calculator alloc] init];</div><div class="line">    calu.opeartionNum = num;</div><div class="line">    </div><div class="line">    return calu;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)buildBlock &#123;</div><div class="line">    __weak typeof(self) weakSelf = self;</div><div class="line">    _add = ^Calculator *(double num)&#123;</div><div class="line">        weakSelf.opeartionNum += num;</div><div class="line">        return weakSelf;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    _reduce = ^Calculator *(double num)&#123;</div><div class="line">        weakSelf.opeartionNum -= num;</div><div class="line">        return weakSelf;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    _multiply = ^Calculator *(double num)&#123;</div><div class="line">        weakSelf.opeartionNum *= num;</div><div class="line">        return weakSelf;</div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">    _divide = ^Calculator *(double num)&#123;</div><div class="line">        //除数为0 不作处理</div><div class="line">        weakSelf.opeartionNum = _opeartionNum / (num == 0 ? 1 : num);</div><div class="line">        return weakSelf;</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>这个Demo非常简单，说的只是链式编程的一个思想,从中我们可以看到，<code>加</code> <code>减</code> <code>乘</code> <code>除</code>四个Block，返回的均是当前对象，<br>我们怎么使用呢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//开始计算</div><div class="line">    Calculator *calu = [Calculator opeartionNum:10.00];</div><div class="line">    calu.add(2).reduce(2).multiply(2).divide(0);</div><div class="line">    //输出结果</div><div class="line">    NSLog(@&quot;result : %f&quot;,calu.opeartionNum);</div></pre></td></tr></table></figure></p>
<p>####3.响应式编程<br>我们先看看<strong>KVO</strong>(Key-Value Observing),直译过来也就是键值观察者模式，监听某个属性的变化，每次指定的被观察的对象的属性被修改后，KVO就会自动通知相应的观察者了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//注册观察者和被观察的属性路径</div><div class="line">[xiaoming addObserver:self forKeyPath:@&quot;age&quot; options: NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld context:nil];</div><div class="line"></div><div class="line">//接受属性变化的消息</div><div class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context</div><div class="line"> &#123;</div><div class="line">     if ([keyPath isEqualToString:@&quot;age&quot;] &amp;&amp; object == xiaoming) &#123;</div><div class="line">        NSLog(@&quot;小明的年龄发生变化&quot;);</div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>接下来介绍一下iOS中一个响应式编程框架<strong>ReactiveCocoa</strong><br>关于响应式编程的概念，我推荐看看上面推荐的那篇帖子<a href="http://www.tuicool.com/articles/BBNRRf" target="_blank" rel="external">响应式编程（Reactive Programming）介绍</a>，举的例子是<code>RxJS</code>，不过整体的概念与<code>ReactiveCocoa</code>无异，吸收思想即可。</p>
<hr>
<h2 id="2-ReactiveCocoa响应式编程框架"><a href="#2-ReactiveCocoa响应式编程框架" class="headerlink" title="###2.ReactiveCocoa响应式编程框架"></a>###2.ReactiveCocoa响应式编程框架</h2><p><code>ReactiveCocoa</code>中常用到的是<code>RACSignal</code>,<code>RACSignal</code>继承自<code>RACStream</code>,<code>Stream</code>这个概念，直译过来也就是<code>事件流</code>的意思，那何为<code>数据流</code>，事件流就是一个按时间排序的Events序列，在这里引用<a href="http://www.tuicool.com/articles/BBNRRf" target="_blank" rel="external">响应式编程（Reactive Programming）介绍</a>其中的介绍，<br><strong>响应式编程使用异步数据流进行编程</strong><br>举个通俗的例子说明事件流：<strong>如何把大象塞进冰箱？</strong></p>
<blockquote>
<ol>
<li>打开冰箱门</li>
<li>把大象塞进冰箱</li>
<li>关上冰箱门</li>
</ol>
</blockquote>
<p>上述三个步骤组合起来就成为一个按时间排序的时间序列，即<code>事件流</code></p>
<hr>
<p>####1.<code>ReactiveCocoa</code>的核心方法</p>
<hr>
<p>打开<code>RACStream</code>可以看到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// Lazily binds a block to the values in the receiver.</div><div class="line">///</div><div class="line">/// This should only be used if you need to terminate the bind early, or close</div><div class="line">/// over some state. -flattenMap: is more appropriate for all other cases.</div><div class="line">///</div><div class="line">/// block - A block returning a RACStreamBindBlock. This block will be invoked</div><div class="line">///         each time the bound stream is re-evaluated. This block must not be</div><div class="line">///         nil or return nil.</div><div class="line">///</div><div class="line">/// Returns a new stream which represents the combined result of all lazy</div><div class="line">/// applications of `block`.</div><div class="line"></div><div class="line">- (instancetype)bind:(RACStreamBindBlock (^)(void))block;</div></pre></td></tr></table></figure></p>
<p>关于其中各个属性的意思，可以看<a href="http://mobile.51cto.com/news-494321.htm" target="_blank" rel="external">RACStreamBindBlock介绍和使用</a>，其中对于各个属性有详细的介绍，<code>bind</code>这个思想理解即可，<code>RAC</code>已经封装了很多更方便的方法供我们使用。</p>
<hr>
<p>####2.<code>ReactiveCocoa</code>的整体结构介绍</p>
<hr>
<p><strong><code>ReactiveCocoa</code>整体可以分为四个部分</strong></p>
<ol>
<li>信号源(事件流)    <code>RACStream</code>      </li>
<li>订阅者    <code>RACSubscriber</code></li>
<li>调度器    <code>RACScheduler</code></li>
<li>清洁工    <code>RACDisposable</code></li>
</ol>
<hr>
<p>#####1.信号源(事件流)    <code>RACStream</code><br>举个例子：在一个具有多重UI状态的界面中，我们要实现一下几个功能</p>
<ul>
<li>1 用户名和密码输入框字数超过限制时改变输入框背景颜色</li>
<li>2 用户名和密码无效和有效时登录按钮的背景颜色设置</li>
</ul>
<hr>
<p><strong>拿第一个问题当做例子</strong><br>我们平时怎么实现的呢，无非就是继承<code>UITextFieldDelegate</code>，在代理中判断输入框中的文字个数是否超过限制，然后改变背景颜色，亦或用KVO实现，这样做无可厚非，但是模板化过于严重，我们想做这个功能，需要声明代理，实现代理方法，同时代理方法中还需要判断<code>delegate</code>中的<code>textfield</code>是用户名输入框还是密码输入框，这样做不仅代码不仅冗长，而且会造成代码不易查看。<br><strong>那么在RAC中我们怎么做呢，看代码</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> //将ViewModel中的属性和控件中的属性绑定到一起</div><div class="line">RAC(_userViewModel,userName) = [_userNameFeild rac_textSignal];</div><div class="line">RAC(_userNameFeild,backgroundColor) = [_userNameFeild.rac_textSignal  </div><div class="line">map:^id(NSString *password) &#123;</div><div class="line">        return weakSelf.userViewModel.isUserNameValid ? [UIColor whiteColor] : [UIColor redColor];</div><div class="line">    &#125;];</div></pre></td></tr></table></figure></p>
<hr>
<p>Tips_1: 这一部分我们可以配合<code>MVVM</code>设计模式使用，将ViewModel与控件绑定到一起，减轻<code>ViewController</code>的负担。<br>具体这一部分的Demo可以查看文末的Github链接，只是一个简单使用<br>Tips_2: 由上可以看到，我们可以将某个功能的代码写的更加集中，更加方便阅读和维护</p>
<hr>
<p>#####2.订阅者 <code>RACSubscriber</code><br>在整个<code>RAC</code>中，我们基本上都是采用<code>信号源-订阅者</code>的这种模式来使用<code>RAC</code>,为了获取到信号源中的value，我们需要订阅这个信号源。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[_userNameFeild.rac_textSignal subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,x);</div><div class="line">    &#125;];</div></pre></td></tr></table></figure></p>
<p>Tips: 我们查看源代码可以发现<code>_userNameFeild.rac_textSignal</code>实现过程就是监听所有的<code>UIControlEventAllEditingEvents</code>事件，然后发出信号，然后我们订阅这个信号源，可以获取到其中的值<code>x</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (RACSignal *)rac_textSignal &#123;</div><div class="line">	@weakify(self);</div><div class="line">	return [[[[[RACSignal</div><div class="line">		defer:^&#123;</div><div class="line">			@strongify(self);</div><div class="line">			return [RACSignal return:self];</div><div class="line">		&#125;]</div><div class="line">		concat:[self rac_signalForControlEvents:UIControlEventAllEditingEvents]]</div><div class="line">		map:^(UITextField *x) &#123;</div><div class="line">			return x.text;</div><div class="line">		&#125;]</div><div class="line">		takeUntil:self.rac_willDeallocSignal]</div><div class="line">		setNameWithFormat:@&quot;%@ -rac_textSignal&quot;, RACDescription(self)];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>好了，上面讲了那么多理论知识，具体如何使用请看下面</p>
<hr>
<p>#####3.调度器<code>RACSubscriber</code> 和 清洁工<code>RACDisposable</code></p>
<ul>
<li>1 调度器RACSubscriber，这一部分是使用GCD的串行队列来实现的，文末Github链接中有对其的简单使用</li>
<li><p>2 清洁工RACDisposable</p>
<blockquote>
<p><code>RACDisposable</code> 在 <code>ReactiveCocoa</code> 中就充当着清洁工的角色，它封装了取消和清理一次订阅所必需的工作。它有一个核心的方法 <code>-dispose</code> ，调用这个方法就会执行相应的清理工作，这有点类似于 <code>NSObject</code> 的 <code>-dealloc</code> 方法。</p>
</blockquote>
<p>:我们上面使用<code>subscribeNext:^(id x) {}</code>这个方法订阅信号源进行处理之后会生成一个清洁工<code>RACDisposable</code>,我们可以手动的调用<code>dispose</code>方法来进行清理工作。</p>
</li>
</ul>
<hr>
<h2 id="Reactive-Cocoa使用"><a href="#Reactive-Cocoa使用" class="headerlink" title="##Reactive Cocoa使用"></a>##Reactive Cocoa使用</h2><p>###* 1 RAC发送消息,并且绑定到控件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (void)racSenderMessage &#123;</div><div class="line">    //延迟2.0S 发送&quot;呵呵哒~&quot;消息</div><div class="line">    RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;呵呵哒~&quot;];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        return nil;</div><div class="line">    &#125;] delay:2.0];</div><div class="line">    //将_userNameFeild的`text`属性与映射后的信号量的值绑定到一起</div><div class="line">    RAC(_userNameFeild,text) = [signal map:^id(NSString *value) &#123;</div><div class="line">        if ([value isEqualToString:@&quot;呵呵哒~&quot;]) &#123;</div><div class="line">            return @&quot;么么哒~&quot;;</div><div class="line">        &#125;</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 2 RAC代理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (void)racProtocol &#123;</div><div class="line">    RACSignal *programmerSignal = [self rac_signalForSelector:@selector(whoAmI) fromProtocol:@protocol(Programmer)];</div><div class="line">    </div><div class="line">    [programmerSignal subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;RAC通知------I&apos;m a great programmer...&quot;);</div><div class="line">    &#125;];</div><div class="line">    @weakify(self);</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        [self_weak_ whoAmI];</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)whoAmI &#123;</div><div class="line">    NSLog(@&quot;whoAmI------my name is %@&quot;,_user.userName);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 3 RAC通知<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (void)racNotification &#123;</div><div class="line">    //接受通知并且处理</div><div class="line">    [[[NSNotificationCenter defaultCenter] rac_addObserverForName:@&quot;RAC_Notifaciotn&quot; object:nil] subscribeNext:^(NSNotification *notify) &#123;</div><div class="line">        NSLog(@&quot;notify.content = %@&quot;,notify.userInfo[@&quot;content&quot;]);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //发出通知</div><div class="line">    [[NSNotificationCenter defaultCenter] postNotificationName:@&quot;RAC_Notifaciotn&quot; object:nil userInfo:@&#123;@&quot;content&quot; : @&quot;i&apos;m a notification&quot;&#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 4 RAC信号拼接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (void)racSignalLink &#123;</div><div class="line">    RACSignal *signal1 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@(1)];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    RACSignal *signal2 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@(2)];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [[signal1 concat:signal2] subscribeNext:^(NSNumber *value) &#123;</div><div class="line">        NSLog(@&quot;RAC信号拼接------value = %@&quot;,value);</div><div class="line">    &#125;];;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-07-02 14:34:16.148 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号拼接------value = 1</div><div class="line">2016-07-02 14:34:16.148 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号拼接------value = 2</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 5 RAC信号合并<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (void)racSignalMerge &#123;</div><div class="line">    RACSignal *signal1 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;清纯妹子&quot;];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    RACSignal *signal2 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;性感妹子&quot;];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [[signal1 merge:signal2] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;RAC信号合并------我喜欢： %@&quot;,x);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-07-02 14:34:16.149 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号合并------我喜欢： 清纯妹子</div><div class="line">2016-07-02 14:34:16.149 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号合并------我喜欢： 性感妹子</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 6 RAC信号组合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">- (void)racSignalCombine &#123;</div><div class="line">    RACSignal *signal1 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;年轻&quot;];</div><div class="line">        [subscriber sendNext:@&quot;清纯&quot;];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    RACSignal *signal2 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;温柔&quot;];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //combineLatest 将数组中的信号量发出的最后一个object 组合到一起</div><div class="line">    [[RACSignal combineLatest:@[signal1, signal2]] subscribeNext:^(RACTuple *x) &#123;</div><div class="line">        //先进行解包</div><div class="line">        RACTupleUnpack(NSString *signal1_Str, NSString *signal2_Str) = x;</div><div class="line">        NSLog(@&quot;RAC信号组合------我喜欢 %@的 %@的 妹子&quot;,signal1_Str,signal2_Str);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //会注意收到 组合方法后还可以跟一个Block  /** + (RACSignal *)combineLatest:(id&lt;NSFastEnumeration&gt;)signals reduce:(id (^)())reduceBlock */</div><div class="line">    /*</div><div class="line">     reduce这个Block可以对组合后的信号量做处理</div><div class="line">     */</div><div class="line">    //我们还可以这样使用</div><div class="line">    [[RACSignal combineLatest:@[signal1, signal2] reduce:^(NSString *signal1_Str, NSString *signal2_Str)&#123;</div><div class="line">        return [signal1_Str stringByAppendingString:signal2_Str];</div><div class="line">    &#125;] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;RAC信号组合(Reduce处理)------我喜欢 %@ 的妹子&quot;,x);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2016-07-02 14:34:16.149 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号合并------我喜欢： 性感妹子</div><div class="line">2016-07-02 14:34:16.150 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号组合------我喜欢 清纯的 温柔的 妹子</div><div class="line">2016-07-02 14:34:16.150 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号组合(Reduce处理)------我喜欢 清纯温柔 的妹子</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 7 RAC信号组合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">- (void)racSignalZIP &#123;</div><div class="line">    RACSignal *signal1 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;年轻&quot;];</div><div class="line">        [subscriber sendNext:@&quot;清纯&quot;];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    RACSignal *signal2 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;温柔&quot;];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //zip 默认会取信号量的最开始发送的对象 所以结果会是 年轻 、温柔</div><div class="line">    [[RACSignal zip:@[signal1,signal2]] subscribeNext:^(RACTuple *x) &#123;</div><div class="line">        RACTupleUnpack(NSString *signal1_Str1,NSString *signal2_Str) = x;</div><div class="line">        NSLog(@&quot;RAC信号压缩------我喜欢 %@的 %@的 妹子&quot;,signal1_Str1, signal2_Str);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2016-07-02 14:34:16.151 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号压缩------我喜欢 年轻的 温柔的 妹子</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 8 RAC信号过滤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">- (void)racSignalFilter &#123;</div><div class="line">    //信号过滤可以参考上面UIButton引用RAC的实例</div><div class="line">    [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@(19)];</div><div class="line">        [subscriber sendNext:@(12)];</div><div class="line">        [subscriber sendNext:@(20)];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;] filter:^BOOL(NSNumber *value) &#123;</div><div class="line">        if (value.integerValue &lt; 18) &#123;</div><div class="line">            //18禁</div><div class="line">            NSLog(@&quot;RAC信号过滤------FBI Warning~&quot;);</div><div class="line">        &#125;</div><div class="line">        return value.integerValue &gt; 18;</div><div class="line">    &#125;]</div><div class="line">      subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;RAC信号过滤------年龄：%@&quot;,x);</div><div class="line">   &#125;];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2016-07-02 14:34:16.151 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号过滤------年龄：19</div><div class="line">2016-07-02 14:34:16.151 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号过滤------FBI Warning~</div><div class="line">2016-07-02 14:34:16.152 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号过滤------年龄：20</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 9 RAC信号传递<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (void)racSignalPass &#123;</div><div class="line">    [[[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;老板向我扔过来一个Star&quot;];</div><div class="line">        return nil;</div><div class="line">    &#125;] flattenMap:^RACStream *(NSString *value) &#123;</div><div class="line">        NSLog(@&quot;RAC信号传递------%@&quot;,value);</div><div class="line">        return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">            [subscriber sendNext:@&quot;我向老板扔回一块板砖&quot;];</div><div class="line">            return nil;</div><div class="line">        &#125;];</div><div class="line">    &#125;] flattenMap:^RACStream *(NSString *value) &#123;</div><div class="line">        NSLog(@&quot;RAC信号传递------%@&quot;,value);</div><div class="line">        return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">            [subscriber sendNext:@&quot;我跟老板正面刚~,结果可想而知&quot;];</div><div class="line">            return nil;</div><div class="line">        &#125;];</div><div class="line">    &#125;] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;RAC信号传递------%@&quot;,x);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2016-07-02 14:34:16.152 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号传递------老板向我扔过来一个Star</div><div class="line">2016-07-02 14:34:16.152 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号传递------我向老板扔回一块板砖</div><div class="line">2016-07-02 14:34:16.152 ReactiveCocoaMVVMDemo[1362:1245988] RAC信号传递------我跟老板正面刚~,结果可想而知</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 10 RAC信号串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">//用那个著名的脑筋急转弯说明吧，“如何把大象放进冰箱里”  第一步，打开冰箱；第二步，把大象放进冰箱；第三步，关上冰箱门。</div><div class="line">- (void)racSignalQueue &#123;</div><div class="line">    //与信号传递类似，不过使用 `then` 表明的是秩序，没有传递value</div><div class="line">    [[[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        NSLog(@&quot;RAC信号串------打开冰箱&quot;);</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        return nil;</div><div class="line">    &#125;] then:^RACSignal *&#123;</div><div class="line">        return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">            NSLog(@&quot;RAC信号串------把大象放进冰箱&quot;);</div><div class="line">            [subscriber sendCompleted];</div><div class="line">            return nil;</div><div class="line">        &#125;];</div><div class="line">    &#125;] then:^RACSignal *&#123;</div><div class="line">        return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">            NSLog(@&quot;RAC信号串------关上冰箱门&quot;);</div><div class="line">            [subscriber sendCompleted];</div><div class="line">            return nil;</div><div class="line">        &#125;];</div><div class="line">    &#125;] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;RAC信号串------Over&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2016-07-02 17:19:53.812 ReactiveCocoaMVVMDemo[1567:2887515] RAC信号串------打开冰箱</div><div class="line">2016-07-02 17:19:53.812 ReactiveCocoaMVVMDemo[1567:2887515] RAC信号串------把大象放进冰箱</div><div class="line">2016-07-02 17:19:53.812 ReactiveCocoaMVVMDemo[1567:2887515] RAC信号串------关上冰箱门</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 11 RAC_Command介绍<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)racCommandDemo &#123;</div><div class="line">    RACCommand *command = [[RACCommand alloc] initWithSignalBlock:^RACSignal *(id input) &#123;</div><div class="line">        return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">            NSLog(@&quot;racCommandDemo------亲，帮我带份饭~&quot;);</div><div class="line">            [subscriber sendCompleted];</div><div class="line">            return nil;</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //命令执行</div><div class="line">    [command execute:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2016-07-02 17:19:53.839 ReactiveCocoaMVVMDemo[1567:2887515] racCommandDemo------亲，帮我带份饭~</div></pre></td></tr></table></figure></p>
<hr>
<p>###* 12 RACSignal 的一些修饰符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line">- (void)racSignalOther &#123;</div><div class="line">    </div><div class="line">    //延迟</div><div class="line">    [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;RAC信号延迟-----等等我~等等我2秒&quot;];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">        return nil;</div><div class="line">    &#125;] delay:2.0] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;RAC信号延迟-----终于等到你~&quot;);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //定时任务，可以代替NSTimer,可以看到`RACScheduler`使用GCD实现的</div><div class="line">    [[RACSignal interval:60*60 onScheduler:[RACScheduler mainThreadScheduler]] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;每小时吃一次药，不要放弃治疗&quot;);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //设置超时时间</div><div class="line">    [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">            [subscriber sendNext:@&quot;hh&quot;];</div><div class="line">            [subscriber sendCompleted];</div><div class="line">            return nil;</div><div class="line">        &#125;] delay:4] subscribeNext:^(id x) &#123;</div><div class="line">            NSLog(@&quot;RAC设置超时时间------请求到数据:%@&quot;,x);</div><div class="line">            [subscriber sendNext:[@&quot;RAC设置超时时间------请求到数据:&quot; stringByAppendingString:x]];</div><div class="line">            [subscriber sendCompleted];</div><div class="line">        &#125;];</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;] timeout:3 onScheduler:[RACScheduler mainThreadScheduler]]</div><div class="line">        subscribeNext:^(id x) &#123;</div><div class="line">            //在timeout规定时间之内接受到信号，才会执行订阅者的block</div><div class="line">            //这这里3秒之内没有接受到信号，所有该次订阅已失效</div><div class="line">            NSLog(@&quot;请求到的数据:%@&quot;,x);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //设置retry次数，这部分可以和网络请求一起用</div><div class="line">    __block int retry_idx = 0;</div><div class="line">    [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        if (retry_idx &lt; 3) &#123;</div><div class="line">            retry_idx++;</div><div class="line">            [subscriber sendError:nil];</div><div class="line">        &#125;else &#123;</div><div class="line">            [subscriber sendNext:@&quot;success!&quot;];</div><div class="line">            [subscriber sendCompleted];</div><div class="line">        &#125;</div><div class="line">        return nil;</div><div class="line">    &#125;] retry:3] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;请求:%@&quot;,x);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //节流阀,throttle秒内只能通过1个消息</div><div class="line">    [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:@&quot;6&quot;];</div><div class="line">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">            [subscriber sendNext:@&quot;66&quot;];</div><div class="line">        &#125;);</div><div class="line">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">            [subscriber sendNext:@&quot;666&quot;];</div><div class="line">            [subscriber sendCompleted];</div><div class="line">        &#125;);</div><div class="line">        </div><div class="line">        return nil;</div><div class="line">    &#125;] throttle:2] subscribeNext:^(id x) &#123;</div><div class="line">        //throttle: N   N秒之内只能通过一个消息，所以@&quot;66&quot;是不会被发出的</div><div class="line">        NSLog(@&quot;RAC_throttle------result = %@&quot;,x);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //条件控制</div><div class="line">    /**</div><div class="line">     解释：`takeUntil:(RACSignal *)signalTrigger` 只有当`signalTrigger`这个signal发出消息才会停止</div><div class="line">     */</div><div class="line">    [[[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [[RACSignal interval:1.0 onScheduler:[RACScheduler mainThreadScheduler]] subscribeNext:^(id x) &#123;</div><div class="line">            //每秒发一个消息</div><div class="line">            [subscriber sendNext:@&quot;RAC_Condition------吃饭中~&quot;];</div><div class="line">        &#125;];</div><div class="line">        return nil;</div><div class="line">    &#125;] takeUntil:[RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        //延迟3S发送一个消息，才会让前面的信号停止</div><div class="line">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(5.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">            NSLog(@&quot;RAC_Condition------吃饱了~&quot;);</div><div class="line">            [subscriber sendNext:@&quot;吃饱了&quot;];</div><div class="line">        &#125;);</div><div class="line">        return nil;</div><div class="line">    &#125;]] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,x);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">//延迟</div><div class="line">2016-07-02 17:36:09.398 ReactiveCocoaMVVMDemo[2040:2898007] RAC信号延迟-----终于等到你~</div><div class="line">//定时任务</div><div class="line">2016-07-02 16:36:12.400 ReactiveCocoaMVVMDemo[2040:2898007] 每小时吃一次药，不要放弃治疗</div><div class="line">2016-07-02 17:36:12.400 ReactiveCocoaMVVMDemo[2040:2898007] 每小时吃一次药，不要放弃治疗</div><div class="line">//设置retry次数，这部分可以和网络请求一起用</div><div class="line">2016-07-02 17:36:07.427 ReactiveCocoaMVVMDemo[2040:2898007] 请求:success!</div><div class="line">//节流阀,throttle秒内只能通过1个消息</div><div class="line">2016-07-02 17:36:10.404 ReactiveCocoaMVVMDemo[2040:2898007] RAC_throttle------result = 66</div><div class="line">2016-07-02 17:36:10.404 ReactiveCocoaMVVMDemo[2040:2898007] RAC_throttle------result = 666</div><div class="line">//takeUntil条件控制</div><div class="line">2016-07-02 18:10:52.074 ReactiveCocoaMVVMDemo[3090:2920422] RAC_Condition------吃饭中~</div><div class="line">2016-07-02 18:10:53.078 ReactiveCocoaMVVMDemo[3090:2920422] RAC_Condition------吃饭中~</div><div class="line">2016-07-02 18:10:54.074 ReactiveCocoaMVVMDemo[3090:2920422] RAC_Condition------吃饭中~</div><div class="line">2016-07-02 18:10:55.077 ReactiveCocoaMVVMDemo[3090:2920422] RAC_Condition------吃饭中~</div><div class="line">2016-07-02 18:10:55.078 ReactiveCocoaMVVMDemo[3090:2920422] RAC_Condition------吃饱了~</div></pre></td></tr></table></figure></p>
<hr>
<p>##文末</p>
<p>本篇文章并未很深的探讨<code>ReactiveCocoa</code>的底层实现方法，权当做抛砖引玉，给大家介绍一下<code>RAC</code>的浅析和使用</p>
<hr>
<p><strong>Github链接和文中所引用的文章链接</strong></p>
<hr>
<p><strong>如果觉得文章对你有所帮助的话，请点个Star啦~</strong></p>
<ul>
<li>1 <a href="https://github.com/jiachenmu/ReactiveCocoaDemo" target="_blank" rel="external">文章中的链式编程和RACDemo</a></li>
<li>2 <a href="https://github.com/benjycui/introrx-chinese-edition?utm_source=tuicool&amp;utm_medium=referral#%E4%BB%80%E4%B9%88%E6%98%AFrp" target="_blank" rel="external">什么是响应式编程?</a></li>
<li>3 <a href="http://ios.jobbole.com/82356/" target="_blank" rel="external">这样好用的ReactiveCocoa，根本停不下来</a></li>
<li>4 <a href="http://mobile.51cto.com/news-494321.htm" target="_blank" rel="external">最快让你上手ReactiveCocoa之进阶篇</a></li>
<li>5 <a href="http://www.cocoachina.com/ios/20160106/14880.html" target="_blank" rel="external">ReactiveCocoa v2.5 源码解析之架构总览</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactiveCocoa/">ReactiveCocoa</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iOS小项目之第二弹-别踩白块" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/30/iOS小项目之第二弹-别踩白块/" class="article-date">
      <time datetime="2016-06-30T01:29:40.000Z" itemprop="datePublished">2016-06-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/30/iOS小项目之第二弹-别踩白块/">iOS小项目之第二弹- 别踩白块</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>#iOS-OC项目 别踩白块(Don’t Tap The White Tile)</p>
<hr>
<p>##写在前面的话</p>
<p>####①别踩白块游戏简介：</p>
<blockquote>
<p>《别踩白块儿 Don’t Tap The White Tile》，这就是这个游戏唯一的一个规则，我们只需要不断踩着黑色方块前进即可，很简单吧？谁都可以会玩，但并不是谁都能玩得很好噢，你呢？快来挑战看看吧！经典模式，以最快的速度到达终点。街机模式，你有能力得多少分就得多少分，没有任何限制，这也是最具挑战性的一个模式。限时模式，在30秒内看你能走几步。极速模式，没有最高速限制的街机模式, 挑战你的极限接力模式，规定时间内完成50块儿，然后会有更多时间去完成另外的50块儿。【复制于百度百科】</p>
</blockquote>
<p>如果你没玩过，没关系 ，上图看看<br><img src="http://upload-images.jianshu.io/upload_images/1299512-1c86ccf35a745617.gif?imageMogr2/auto-orient/strip" alt="别踩白块儿.gif"><br>意思就是：每行有四个按钮，黑色的按钮是正确的需要你点击的按钮，白色块点击后游戏失败，所以这个游戏就叫”别踩白块儿”😂，别问我我为什么这么机智。</p>
<p>####②写这个小游戏的目的</p>
<p>#####<strong>最重要 :  <strong>纯属好玩</strong></strong><br>我觉得做一件事情最大的推动力就是 <strong>兴趣</strong> <strong>兴趣</strong> <strong>兴趣</strong>。<br>看到好多游戏都是拿Unity3D、Cocos2D开发的，我就想 我用系统自带的一些东海也可以实现一些简单的平面2D动画呀，所以我试了试，所以就有了这篇简书。</p>
<p>#####<strong>电商之类的app不美观</strong><br>前面仿写过<a href="http://www.jianshu.com/p/7b57eb0c4abe" target="_blank" rel="external">半糖app</a>，公司也是电商的app，所以对于电商app无爱了，,,Ծ‸Ծ,,，都是 首页、分类、购物车、个人中心的套路，你懂的。相反我倒是更喜欢一些电商入口的APP，就比如半糖、美丽说、小红书之类的app，UI很美观，这是吸引我的地方。</p>
<hr>
<p>##项目整体的概括</p>
<p>####①开发周期：<br>工作闲暇之余累计有10天左右，最近一个半月在忙公司的项目，只好抽时间写啦</p>
<p>####②开发工具和语言：<br> 开发工具为Xcode7.3   语言为Objective-C<br>因为前面仿写半糖app的时候，好多朋友给我说不太懂swift，那我就写个OC的小项目</p>
<p>####③开发要点：<br><strong>游戏成功、失败的逻辑代码基于 <code>ReactiveCocoa</code> ,代码有详细的解释。</strong><br>音频管理、整体的UI搭建不难，难的是整体游戏逻辑的设计。</p>
<hr>
<p>##项目详细实现过程</p>
<p>####①首页，页面较为简单，主要介绍一下 UIButton与 <code>ReactiveCocoa</code>的结合使用</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-81e0e7253713d485.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp58f5a0f6.png"></p>
<p>–主要代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//开始游戏按钮</div><div class="line">    _startButton = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH/2, SCREEN_HEIGHT)];</div><div class="line">    _startButton.backgroundColor = [UIColor blackColor];</div><div class="line">    [_startButton setTitle:@&quot;开始游戏&quot; forState:UIControlStateNormal];</div><div class="line">    [_startButton setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];</div><div class="line">    WeakSelf;</div><div class="line">    [[_startButton rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) &#123;</div><div class="line">        [weakSelf buttonHideAnimation];</div><div class="line">        [weakSelf  presentViewController:[[GameSceneViewController alloc] init] animated:false completion:^&#123;</div><div class="line">            //弹出游戏窗体后 暂停BGM</div><div class="line">            [SoundPlayer pauseBGM];</div><div class="line">        &#125;];</div><div class="line">        NSLog(@&quot; start game :)&quot;);</div><div class="line">    &#125;];</div><div class="line">    [self.view addSubview:_startButton];</div></pre></td></tr></table></figure></p>
<p>解释：<code>[_startButton rac_signalForControlEvents:UIControlEventTouchUpInside]</code>返回一个 <code>RACSignal</code>,可以理解为 一个信号，后面 <code>subscribeNext:^(id x) {}</code> 意思就是 接受到这个信号所做的操作。从字面意思上可以理解为，前者当你点击按钮，触发<code>UIControlEventTouchUpInside</code>事件的时候 ，发出一个信号，后者是接受到这个信号，你要干什么，由你决定。</p>
<p>####②游戏页面view，</p>
<p> #####倒计时动画介绍<br>上图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-76ac222f93784caa.gif?imageMogr2/auto-orient/strip" alt="倒计时动画.gif"><br>—-构成：view背景为黑色，中间添加了一个label，显示当前的数字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">*  倒计时 anim ......3 2 1 动画</div><div class="line">*</div><div class="line">*  @param anim          anim 变化的数字初始值</div><div class="line">*  @param completeBlock 动画结束后的操作</div><div class="line">*/</div><div class="line">- (void)showWithAnimNum:(NSInteger)anim CompleteBlock:(CompleteBlock)completeBlock;</div></pre></td></tr></table></figure>
<p>—-实现思路： 要做的从给定的参数 <code>anim</code>  递减到 0  之后结束动画，然后执行<code>completeBlock</code><br>，我是这样写一个类似于递归的动画：<br>①整体动画可以分为很多个，单个数字，做缩放和透明度改变的动画组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//返回一个 动画group</div><div class="line">- (CAAnimationGroup *)animationGroup &#123;</div><div class="line">    //缩放</div><div class="line">    CABasicAnimation *animation1 = [CABasicAnimation animation];</div><div class="line">    [animation1 setKeyPath:@&quot;transform.scale&quot;];</div><div class="line">    [animation1 setFromValue:@1.0];</div><div class="line">    [animation1 setToValue:@4.0];</div><div class="line">    [animation1 setDuration:1.0];</div><div class="line">    //改变透明度</div><div class="line">    CABasicAnimation *animation2 = [CABasicAnimation animation];</div><div class="line">    [animation2 setKeyPath:@&quot;alpha&quot;];</div><div class="line">    [animation2 setFromValue:@1.0];</div><div class="line">    [animation2 setToValue:@0.3];</div><div class="line">    [animation2 setDuration:1.0];</div><div class="line">    </div><div class="line">    </div><div class="line">    CAAnimationGroup *animGroup = [[CAAnimationGroup alloc] init];</div><div class="line">    animGroup.animations = [NSArray arrayWithObjects:animation1,animation2, nil];</div><div class="line">    [animGroup setDuration:1.0];</div><div class="line">    [animGroup setDelegate:self];</div><div class="line">    return animGroup;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>@用一个参数控制整体的动画的继续和停止，就是<code>_animIndex</code><br>每一个动画group执行完毕后，在 <code>- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag</code> 中进行<code>_animIndex--</code>，并且添加下一组动画，看代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// - MARK: Animation Delegate</div><div class="line">- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag &#123;</div><div class="line">    if (flag &amp;&amp; _animIndex &gt; 0) &#123;</div><div class="line">        _animIndex--;</div><div class="line">        _animLabel.text = [NSString stringWithFormat:@&quot;%ld&quot;,(long)_animIndex];</div><div class="line">        [_animLabel.layer addAnimation:[self animationGroup] forKey:nil];</div><div class="line">    &#125;</div><div class="line">    //动画执行完毕后 执行的操作</div><div class="line">    if (_animIndex == 0) &#123;</div><div class="line">        if (_completeBlock != nil) &#123;</div><div class="line">            //延迟0.4s之后 再开始游戏 防止游戏开始太快 user接受不了</div><div class="line">            self.hidden = true;</div><div class="line">            WeakSelf;</div><div class="line">            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.4 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">                _completeBlock();</div><div class="line">                [weakSelf.animLabel.layer removeAllAnimations];</div><div class="line">                weakSelf.hidden = false;</div><div class="line">                [weakSelf removeFromSuperview];</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> #####游戏界面如何搭建<br>①首页整体界面搭建<br><img src="http://upload-images.jianshu.io/upload_images/1299512-23020b7609d725bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="B7A2A5EB-B936-4ABD-BF2A-F6135389EC0C.png"><br>界面中每一个被我框起来的都是我封装的 <code>GameSceneView</code>,当然我们不能在每一个<code>GameSceneView</code>那如何实现’’重用’呢’<br><strong>实现思路：</strong><br>①计算你的屏幕中需要多少个<code>gameScene</code>，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// - 1: 先计算出 屏幕中需要多少个 scene</div><div class="line">    _sceneCount = ceil(SCREEN_HEIGHT / WhiteBlockHeight) + 1;</div></pre></td></tr></table></figure></p>
<p>②创建与之等同数量的scene<br><code>_frameArray</code>存储的是 scene创建时的初始frame,便于点击错误时，直接恢复到初始的frame<br><code>_operateArray</code>将创建好的scene集中到一起，便于管理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[_frameArray addObject:[NSValue valueWithCGRect:scene.frame]];</div><div class="line">[_operateArray addObject:scene];</div></pre></td></tr></table></figure></p>
<p>屏幕上所有的 <code>scene</code>都是向下滚动的，每次滚动判断是否超出屏幕，当用户点击正确、scene漂移到屏幕外的时候，再更新<code>scene</code>的<code>frame</code>，这个scene将被安排到最后一个<code>scene</code>的后面，上代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillAppear:(BOOL)animated &#123;</div><div class="line">    [super viewWillAppear:animated];</div><div class="line">    </div><div class="line">    //用 CADisplayLink 进行刷新 频率更快，动画效果不会卡顿</div><div class="line">    disPlayLink = [CADisplayLink displayLinkWithTarget:self selector:@selector(startScroll)];</div><div class="line">    </div><div class="line">    //先执行 3 2 1 这样的动画</div><div class="line">    [[StartAnimView shareInstance] showWithAnimNum:3 CompleteBlock:^&#123;</div><div class="line">        [disPlayLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSRunLoopCommonModes];</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>disPlayLink一直在调用 <code>- (void)startScroll</code>这个方法，刷新界面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">//开始滚动</div><div class="line">- (void)startScroll &#123;</div><div class="line">    WeakSelf;</div><div class="line">    </div><div class="line">    [_operateArray enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</div><div class="line">        //</div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">            GameSceneView *scene = (GameSceneView *)obj;</div><div class="line">            CGRect frame = scene.frame;</div><div class="line">            frame.origin.y += _gameSpeed * 2.0;</div><div class="line">            if (!*stop) &#123;</div><div class="line">                scene.frame = frame;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            //  用户点击超时没有点击</div><div class="line">            if ( scene.frame.origin.y &gt;= SCREEN_HEIGHT &amp;&amp; scene.completeType == CompleteTypeNotClick)</div><div class="line">            &#123;</div><div class="line">                //停止刷新</div><div class="line">                [disPlayLink invalidate];</div><div class="line">                *stop = false;</div><div class="line">                </div><div class="line">                //弹出失败页面</div><div class="line">                [weakSelf resetGame];</div><div class="line">        </div><div class="line">            &#125;else if( scene.frame.origin.y &gt; SCREEN_HEIGHT &amp;&amp; scene.completeType == CompleteTypeVictory)&#123;</div><div class="line">                // 用户点击成功  计算新的frame</div><div class="line">                scene.frame = [weakSelf calculateNewFrameWithTag:scene.tag];</div><div class="line">                [scene reSet];</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>点击正确之后 计算该 <code>scene</code>新的frame<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//点击正确之后 将超出屏幕的scene 改变frame ，让玩家感觉一直有新scene的出来</div><div class="line">- (CGRect)calculateNewFrameWithTag: (NSInteger )tag &#123;</div><div class="line">    tag = tag == 0 ? _sceneCount - 1 : tag - 1;</div><div class="line">    </div><div class="line">    GameSceneView *scene = (GameSceneView *)[_operateArray objectAtIndex:tag];</div><div class="line">    CGRect frame = scene.frame;</div><div class="line">    frame.origin.y -= WhiteBlockHeight;</div><div class="line">    return frame;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这一部分用图很好解释：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-4e87160e38bfa764.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp13f239f2.png"><br>红色框为屏幕范围， 第0个<code>scene</code>超出屏幕后，新的位置即在 第4个<code>scene</code>的后面</p>
<h5 id="GameSceneView-的构建"><a href="#GameSceneView-的构建" class="headerlink" title="GameSceneView 的构建"></a>GameSceneView 的构建</h5><p>这一部分有一个小遗憾，应该将每行的button数量写成 参数，不应该写成4😀<br>每个button通过  button.layer的borderColor 和 borderWidth属性设置边框，所以显的有点粗糙。<br>主要代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">// - MARK: private method</div><div class="line">//快速构建button</div><div class="line">- (UIButton *)quickCreateButtonWithFrame:(CGRect)frame&#123;</div><div class="line">    UIButton *btn = [[UIButton alloc] initWithFrame:frame];</div><div class="line">    </div><div class="line">    btn.selected = false;</div><div class="line">    btn.layer.borderColor = [UIColor blackColor].CGColor;</div><div class="line">    btn.layer.borderWidth = 0.5;</div><div class="line">    btn.backgroundColor = [UIColor whiteColor];</div><div class="line"></div><div class="line">    WeakSelf;</div><div class="line">    [[[btn rac_signalForControlEvents:UIControlEventTouchUpInside]</div><div class="line">      map:^id(id value) &#123;</div><div class="line">          if(!weakSelf.isHasOtherSelected &amp;&amp; weakSelf.goalIndex == btn.tag)&#123;</div><div class="line">              // 没人点击 and 点击按钮为目标按钮 -&gt; click正确</div><div class="line">              btn.selected = false;</div><div class="line">              weakSelf.isHasOtherSelected = true;</div><div class="line">              weakSelf.completeType = CompleteTypeVictory;</div><div class="line">//              [SoundPlayer playWithMusicName:_effect];</div><div class="line">              weakSelf.clickBlock(CompleteTypeVictory);</div><div class="line">              return [UIColor whiteColor];</div><div class="line">          &#125;else if(!weakSelf.isHasOtherSelected &amp;&amp; weakSelf.goalIndex != btn.tag) &#123;</div><div class="line">              //点击btn 不是 目标 -&gt; click错误</div><div class="line">              weakSelf.completeType = CompleteTypeFailure;</div><div class="line">              weakSelf.isHasOtherSelected = true;</div><div class="line">//              [SoundPlayer playWithMusicName:ErrorEffect];</div><div class="line">              //点击错误之后 将正确的btn 执行动画</div><div class="line">              [weakSelf clickButtonFailureWithButton:btn];</div><div class="line">              return [UIColor orangeColor];</div><div class="line">          &#125;</div><div class="line">          return [UIColor whiteColor];</div><div class="line">          </div><div class="line">    &#125; ]subscribeNext:^(UIColor *color) &#123;</div><div class="line">        btn.backgroundColor = color;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    return btn;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>解释一下：<br><strong>对于其中<code>ReactiveCocoa</code>的解释</strong><br><code>[btn rac_signalForControlEvents:UIControlEventTouchUpInside]</code>就是当你点击button的时候 会发出一个信号，<code>map:^id(id value) { ........}</code>是接受到该信号之后，你做的一些操作，返回一个value对象 ，<code>subscribeNext:^(id value) {.......}</code> 就是 对于接受到的<code>value</code>做的一些操作</p>
<p>用一个比喻来说，<code>[btn rac_signalForControlEvents:UIControlEventTouchUpInside]</code> 就是水源，<code>map:^id(id value) { ........}</code>就是农夫山泉加工厂，<code>subscribeNext:^(id value) {.......}</code>就是水送到你手里了，你要干什么，洗脸洗脚喝掉随便你。。</p>
<p><strong>对于游戏逻辑的解释：</strong><br>①<code>isHasOtherSelected</code>这个bool类型的变量 ：<br>true代表已经有一个button被点击  false代表没有button被点击<br>②根据点击成功与否,返回完成状态completeType<br>点击成功：<code>weakSelf.clickBlock(CompleteTypeVictory);</code><br>点击失败：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//点击错误之后  将失败的btn 闪烁下</div><div class="line">              [weakSelf clickButtonFailureWithButton:btn];</div></pre></td></tr></table></figure></p>
<p>button闪烁动画如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//点击错误 让点错的button 闪烁</div><div class="line">- (void)clickButtonFailureWithButton:(UIButton *)sender&#123;</div><div class="line">    </div><div class="line">    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;opacity&quot;];//必须写opacity才行。</div><div class="line">    animation.fromValue = [NSNumber numberWithFloat:1.0f];</div><div class="line">    animation.toValue = [NSNumber numberWithFloat:0.0f];//这是透明度。</div><div class="line">    animation.autoreverses = YES;</div><div class="line">    animation.duration = 0.2;</div><div class="line">    animation.repeatCount = 4;</div><div class="line">    animation.removedOnCompletion = NO;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    animation.timingFunction=[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];///渐进动画</div><div class="line">    [animation setDelegate:self];</div><div class="line">    [sender.layer addAnimation:animation forKey:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//闪烁完毕后 返回失败状态</div><div class="line">- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag &#123;</div><div class="line">    if (flag) &#123;</div><div class="line">        self.clickBlock(CompleteTypeFailure);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="音频处理、"><a href="#音频处理、" class="headerlink" title="音频处理、"></a>音频处理、</h5><p><code>SoundPlayer</code>这个类负责播放音频,调用<code>AVAudioPlayer</code>来播放音频<br>有三个方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//按钮点击时播放的声音</div><div class="line">+ (void)playWithMusicName: (NSString *)fileName;</div><div class="line"></div><div class="line">//播放背景音乐</div><div class="line">+ (void)playBackgroundMusicWithName: (NSString *)fileName;</div><div class="line"></div><div class="line">//暂停背景音乐</div><div class="line">+ (void)pauseBGM;</div></pre></td></tr></table></figure></p>
<p><strong>关于点击音效的处理</strong><br>我有两个方案，都在代码里面<br>①点击按钮时，按点击次数来播放对应的声音：<br>具体实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">if (type == CompleteTypeVictory) &#123;</div><div class="line">        //点击成功  播放相应的 music</div><div class="line">        if (_clickIndex &gt; 213) &#123;</div><div class="line">            _clickIndex = (NSInteger)_clickIndex % 213;</div><div class="line">        &#125;</div><div class="line">        NSString *fileName = [NSString stringWithFormat:@&quot;C-%ld&quot;,_clickIndex];</div><div class="line">        if (_clickIndex &lt;= 9) &#123;</div><div class="line">            fileName = [NSString stringWithFormat:@&quot;C-0%ld&quot;,_clickIndex];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        [SoundPlayer playWithMusicName:fileName];</div><div class="line">        // 更新当前分数</div><div class="line">        _currentScore += 1.0;</div><div class="line">        // 根据当前分数 计算白块移动速度</div><div class="line">        [self updateGameSpeed];</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><strong>关于音频的来源</strong>：我将 <em>马克西姆</em> 的<strong>克罗地亚狂想曲</strong>分成了每个部分为1s的片段,大概200多个片段<br>这一部分有个<strong>疑问</strong>:声音文件一般不是分为左右声道吗，我将其中一个声道抽离出来当做背景音乐，另一个声道文件分成若干分，当按钮点击时播放是不是更好？懂电子音频处理的朋友出来回答下呗。</p>
<p>##项目感想<br>①其实复杂动画也是 “缩放” “旋转” “改变透明度” “移动”等一些基础动画的组合，下次遇到动画的时候可以试着将动画进行分解，这样就会减小实现的难度，<br>②尽量将代码写的清晰易懂，不忙的时候多回去review代码，就可以发现当初代码的一些不合理的逻辑，这样才会进步，这些天回去将我的<a href="http://www.jianshu.com/p/7b57eb0c4abe" target="_blank" rel="external">高仿半糖app</a> review下，古人老话，<strong>温故而知新 可以为师矣</strong><br>③学习之路，<strong>任重而道远，路漫漫其修远兮，吾将上下而求索</strong></p>
<p>##Github项目下载地址<br><strong>温馨提示：</strong>app启动后 会有背景音乐响起，so，你懂的，点击按钮也会播放 <strong>克罗地亚狂想曲</strong>的片段，运行时请请调低音量</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-d22eeea07435f018.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="请运行.xcworkspace"><br><a href="https://github.com/jiachenmu/Don-tTapTheWhiteTile" target="_blank" rel="external">点击去我的Github下载</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS小项目-App/">iOS小项目 App</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iOS小项目之第一弹-壁纸天气" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/30/iOS小项目之第一弹-壁纸天气/" class="article-date">
      <time datetime="2016-06-30T01:28:55.000Z" itemprop="datePublished">2016-06-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/30/iOS小项目之第一弹-壁纸天气/">iOS小项目之第一弹- 壁纸天气</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <hr>
<p>##前言 ：</p>
<hr>
<p><strong>1. 整体项目回顾</strong><br> 距离上次发表文章也有大概两个月的时间了吧，这段时间一直在忙着公司的项目。没有时间review代码（可能是比较懒吧😅，以后一定改正），这个”壁纸天气”前前后后大概花了10天时间，设计、开发都是我（PS：不好看就将就着看，我只是一个有情怀的程序猿😜），都是下班了写写，代码比较简单，结构也不是很复杂。</p>
<p><strong>3. 做这个app的初衷</strong><br>前面做的高仿项目都是高仿app，数据都是本地数据，这次想玩玩网上的，刚开始只是看到百度ApiStore上有免费的天气接口，我就试着用了一下，感觉还不错，那就干脆写个天气app玩玩吧。<del>我就想要一个简单的app，就显示天气就好，其余过多的动画效果不需要，整体的页面无非就是<code>UITableView</code>、<code>UICollectionView</code>和一些 <code>UILabel</code>、<code>UIButton</code>的组合，理清楚思路就很好做了，其实UI搭建本身就是一件简单的事情，难的在于业务和逻辑的处理上。</del></p>
<p><strong>3.为什么叫壁纸天气？</strong><br>为了弥补画面的突兀感，主要是大片大片的白，我也不懂如何配色，我都用一张图片当做背景，O(∩_∩)O~~，所以我就起名叫做”壁纸天气”了。</p>
<hr>
<p>##项目的整体介绍：</p>
<hr>
<p>###<strong>1. 功能简介：</strong></p>
<p>####Tips:功能比较少，有以下几个：</p>
<p>#####①.  显示天气：首页显示添加过的城市的天气</p>
<p>#####②.  添加城市: 仅限与国内。</p>
<p>#####③.  管理已经添加的城市<br><code> </code></p>
<p>###<strong>2. 功能展示：</strong></p>
<p>#####①. 天气展示主页面 :类似于首页</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-abf220551fb21483.gif?imageMogr2/auto-orient/strip" alt="首页展示.gif"></p>
<p>######点击每一个城市，弹出天气详情View，会显示该城市的历史天气和预测天气，其中今日天气还有诸如感冒指数、穿衣指数等一些提示。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-f994d293274ee756.gif?imageMogr2/auto-orient/strip" alt="天气详情.gif"></p>
<p>#####②. 添加城市<br>输入城市中文名，然后展示搜索结果，选择要添加的城市即可。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-60d3e8005c05d251.gif?imageMogr2/auto-orient/strip" alt="添加城市.gif"></p>
<p>#####③. 管理已经添加的城市<br>点击X删除选择的城市，<br><img src="http://upload-images.jianshu.io/upload_images/1299512-af536d4faed69db2.gif?imageMogr2/auto-orient/strip" alt="管理城市.gif"></p>
<p>#####③. 关于作者(PS:这一部分其实不算功能了吧😁)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-9971c3e9aac4bbdf.gif?imageMogr2/auto-orient/strip" alt="关于作者.gif"></p>
<p><code> </code></p>
<p>###<strong>3. 项目的实现方法：</strong></p>
<p>#####①. 开发过程中，大多数采用xib，我从纯代码的海洋里爬出来，看到了xib的新大陆😄，xib使用还是很方便的，代码量也少了很多，可是我依然喜欢纯代码😂</p>
<p>#####②.  数据的来源、请求与处理：<br>—–1.数据来源于百度ApiStore中的两个免费的天气接口,返回的数据都是JSON字符串：</p>
<p><strong><a href="http://apistore.baidu.com/apiworks/servicedetail/112.html" target="_blank" rel="external">百度接口链接</a></strong></p>
<blockquote>
<p>第一个：根据城市中文名称 查询城市ID<br>第二个： 根据城市ID查询近7天的天气<br>图片展示：</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-c9730c120b233fe3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="A5873AE1-3A82-496D-AE04-A1FEC252BFFE.png"><br>—–2.数据请求：<br>使用<code>NSURLSession</code>对应两个接口 封装了两个请求，没有使用第三方库。<br>—–3.数据处理：<br> ① 根据JSON字符串写了对应的模型，使用<code>MJExtension</code>解析JSON，并转成对应的<code>model</code><br> ②数据存储采用<code>NSUserDefaults</code>，对于项目的城市的存储操作封装了一个类<code>CityManager</code>，管理所有的存储、读取操作(比如 返回热门城市列表、返回当前已选择的城市)<br>Tips:由于<code>NSUserDefaults</code>不能存储自定义对象，所以需要先归档后存储</p>
<hr>
<p>##项目感想：</p>
<hr>
<p><code>`好吧，还没有怎么写就到项目感想了，这个项目结构非常简单，东西也比较少，但是麻雀虽小、五脏俱全，本地存储、网络请求都有，主要是这个</code>方正喵呜`字体真的非常萌啊，基本上所有的文字都采用的这个字体。由于精力有限，对应各种天气的图片并不全，只有几个大分类，比如’’小雨”、”中雨”、”大雨”我都用的一个图片˜😂，所以如果觉得粗糙，请见谅，哈哈。</p>
<p>正儿八经的说，做完这个小app，最主要的一个感想就是 <em>“做很简单，做好就不容易了”</em></p>
<p>好吧，第一弹就到这里了</p>
<p>####下一弹预告 ：</p>
<h6 id="一个黑白相间的、考验手速的小游戏，"><a href="#一个黑白相间的、考验手速的小游戏，" class="headerlink" title="一个黑白相间的、考验手速的小游戏，"></a>一个黑白相间的、考验手速的小游戏，</h6><p>##Github下载地址：</p>
<hr>
<p><a href="https://github.com/jiachenmu/WallpaperWeather" target="_blank" rel="external">点击去我的Github转转，觉得不错就赏个★</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS小项目-App/">iOS小项目 App</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Swift2-0-高仿半塘App" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/30/Swift2-0-高仿半塘App/" class="article-date">
      <time datetime="2016-06-30T01:27:39.000Z" itemprop="datePublished">2016-06-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/30/Swift2-0-高仿半塘App/">Swift2.0 高仿半塘App</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>#IOS-Swift2.0 高仿半糖App</p>
<hr>
<p>##写在前面的话<br>–少年我是去年毕业做IOS开发的，这个项目大概是2016年1月份到现在做完的，项目刚开始没学过Swift语言，但想着不会就该去挑战，于是边学习边做这个项目，现在对Swift也有了一定的了解<br>，在此感谢<a href="http://www.jianshu.com/users/5fe7513c7a57/latest_articles" target="_blank" rel="external">维尼的小熊</a>的指导</p>
<p>##关于项目(GitHub地址在文章最下方)<br>–这个开源项目为半糖，<a href="http://www.ibantang.com" target="_blank" rel="external">官网➡</a>,类似于美丽说，一款电商App，使用语言:Swift2.0,开发工具: Xcode 7.1,纯代码开发,耗时两个多月，数据为本地数据，用Charles进行抓包。<br>–项目测试机为5S，UI没有对6/6S进行适配<br>–因为开发时间有限，APP里面的各种分类相当繁多，因此首页中测试的话点第一个分类，第一个cell，一般都是有数据的，没有也会提示。<br>–我是个新手,Bug是难免的嘛。如果发现有Bug和疑问，请向我联系，QQ、简书、微博都可以<br>–Tips:首页支持3D Touch，可以试试哦~</p>
<p>##项目效果图</p>
<p>####首页展示<br><img src="http://upload-images.jianshu.io/upload_images/1299512-f59c8f1a63af8958.gif?imageMogr2/auto-orient/strip" alt="首页轮播图加展示.gif"></p>
<p>#####首页-清单展示</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-bafce461cd2e285b.gif?imageMogr2/auto-orient/strip" alt="首页-清单展示.gif"></p>
<p>#####首页-搜索分类展示</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-0d90d236d859233e.gif?imageMogr2/auto-orient/strip" alt="首页-搜索展示.gif"></p>
<p>####3D Touch展示(用6S及6S以上测试)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-3c0e3ba29e9f00d8.gif?imageMogr2/auto-orient/strip" alt="3DTouch展示.gif"></p>
<p>####广场展示<br><img src="http://upload-images.jianshu.io/upload_images/1299512-033b26149abfad1d.gif?imageMogr2/auto-orient/strip" alt="首页-广场展示.gif"></p>
<p>####秀</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-626bdc9943daf60d.gif?imageMogr2/auto-orient/strip" alt="秀我展示.gif"></p>
<p>####消息(这一部分😂，我没好友，没粉丝，抓包木有数据，所以就按照自己的想法做咯)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-6dca6a94de88f6ff.gif?imageMogr2/auto-orient/strip" alt="消息.gif"></p>
<p>####个人中心(换头像请用真机测试~)</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-1295962d038abd25.gif?imageMogr2/auto-orient/strip" alt="个人中心.gif"></p>
<p>##项目详细讲解 (按APP的启动顺序来)</p>
<p>####启动页面</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-5510cff43f75da01.gif?imageMogr2/auto-orient/strip" alt="启动页面.gif"><br>主要代码如下:<br>1.在appDelegate中<br><code>self.window?.rootViewController = mainViewController()</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//MARK: App首次启动显示 app的简介</div><div class="line">    func mainViewController() -&gt; UIViewController&#123;</div><div class="line">        //firstStart不为空,不是是第一次启动</div><div class="line">        if  NSUserDefaults.standardUserDefaults().objectForKey(&quot;FirstStart&quot;) != nil &#123;</div><div class="line">            return self.tabbarController</div><div class="line">        &#125;else &#123;</div><div class="line">            //是第一次启动</div><div class="line">            NSUserDefaults.standardUserDefaults().setObject(false, forKey: &quot;FirstStart&quot;)</div><div class="line">            let firstVC = FirstStartViewController()</div><div class="line"></div><div class="line">            return firstVC</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>Tips: 用户第一次启动App的时候<code>self.window.rootViewController = FirstStartViewController()</code>  使用户进入引导页，动画完成后，点击『开启App之旅』,引导页发出 通知，appDelegate接受通知，再将<code>self.window?.rootViewController = self.tabBarController</code></p>
<p>####首页-展示</p>
<p>#####①最好的设计思路应该是这样的：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-84bab42ca5fbfa65.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp4c68a801.png"><br>Tips：以下的思路 在个人中心很完整，前去看看哈</p>
<p>######1.红色部分设计为 collectionHeaderView<br>方法： 初始化collecitonView时  在其layout参数中设置<br><code>layout.headerReferenceSize = CGSizeMake(width, height)</code><br>然后collectionView 注册这个headerView<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public func registerClass(viewClass: AnyClass?, forSupplementaryViewOfKind elementKind: String, withReuseIdentifier identifier: String)`</div><div class="line">然后 在collectionView代理方法</div><div class="line">`func collectionView(collectionView: UICollectionView, viewForSupplementaryElementOfKind kind: String, atIndexPath indexPath: NSIndexPath) -&gt; UICollectionReusableView &#123;</div><div class="line">        var reuseView = UICollectionReusableView()</div><div class="line">        if kind == UICollectionElementKindSectionHeader &#123;</div><div class="line">            let headView = collectionView.dequeueReusableSupplementaryViewOfKind(UICollectionElementKindSectionHeader, withReuseIdentifier: &quot;collectionViewHeaderView&quot;, forIndexPath: indexPath)</div><div class="line">            </div><div class="line">            headView.addSubview(collectionHeadView)</div><div class="line">            reuseView = headView</div><div class="line">        &#125;</div><div class="line">        return reuseView</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>######2.绿色部分为collectionView 只作为容器使用</p>
<p>######3.蓝色部分为显示的tableview，添加到collectionView的cell.contentView进行显示<br>Tips:现在很多App的启动页面也是这个思路，整体为一个UICollectionView，每一个cell都添加UITableView进行显示</p>
<p>#####②关于cell 动态高度的问题,上图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-4f95d6d29d3a0ec3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp3734bf84.png"><br>蓝色的这一部分是清单详情中的描述内容，JSON中的描述文字都不一样，所以导致整个cell的高度都是动态不定的<br>Tips：<br>1.在cell所有的model中添加<code>cellHeight</code>字段,在tableView代理方法<code>heightForRowAtIndexPath</code>中,判断model中的<code>cellHeight</code>字段是不是为空，有值则返回该值,类似<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">func tableView(tableView: UITableView, heightForRowAtIndexPath indexPath: NSIndexPath) -&gt; CGFloat &#123;</div><div class="line">       //model为对应cell的model</div><div class="line">      if model.cellHeight != nil &#123;</div><div class="line">             return model.cellHeight</div><div class="line">       &#125;</div><div class="line">    return 30</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.cell中的属性model 重写set方法，类似<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var model: YourModel&#123;</div><div class="line">  didSet&#123;</div><div class="line">        //--------</div><div class="line">            做你的操作</div><div class="line">        //-------</div><div class="line">        if model.cellHeight == nil &#123;</div><div class="line">        model.cellHeight = 你计算后的高度</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>#####③ 3D Touch<br>Tips:其实App中应用最多的也就是不用点进去看。可以预览下一级显示的内容，比如 微信</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-a13038df731a2086.gif?imageMogr2/auto-orient/strip" alt="3D Touch通用.gif"><br>上代码：<br><code>viewDidLoad()</code>中 <code>self.add3DTouch()</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//MARK: 添加 3D touch功能</div><div class="line">    func add3DTouch() &#123;</div><div class="line">        //1.检测 3D touch 是否可用</div><div class="line">        if traitCollection.forceTouchCapability == .Available &#123;</div><div class="line">            //3DTouch可用，</div><div class="line">            registerForPreviewingWithDelegate(self, sourceView: view)</div><div class="line">        &#125;else &#123;</div><div class="line">            //不可用</div><div class="line">            TipView.showMessage(&quot;不支持3Dtouch,换个6S吧,不谢😂&quot;)    </div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>Tips：<br>1 <code>registerForPreviewingWithDelegate(delegate: UIViewControllerPreviewingDelegate, sourceView: UIView)</code>方法中delegate即为当前控制器self，<code>sourceView</code>即为感应3DTouch功能的View，当前控制器中，我选择的是<code>self.view</code><br>2.控制器上添加代理<code>UIViewControllerPreviewingDelegate</code>,实现方<code>func previewingContext(previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint) -&gt; UIViewController?</code>和<code>func previewingContext(previewingContext: UIViewControllerPreviewing, commitViewController viewControllerToCommit: UIViewController)</code>,<br>看代码:</p>
<p>①这一部分其实就两个步骤</p>
<ul>
<li>1.给3D Touch 你要预览的ViewController</li>
<li>2.设定3D Touch预览控制器的尺寸大小</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">func previewingContext(previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint) -&gt; UIViewController? &#123;</div><div class="line">        </div><div class="line">        </div><div class="line">        //-----这一过程这么繁琐  说白了就是找到当前手指点到的 tableviewCell，后面 3Dtouch 预览的时候会用到 原尺寸 cell.frame</div><div class="line">        let index = Int( showCollectionView.contentOffset.x / SCREEN_WIDTH )</div><div class="line">        let collectionViewCell = showCollectionView.cellForItemAtIndexPath(NSIndexPath(forRow: 0, inSection: index))</div><div class="line">        var tableView = UITableView()</div><div class="line">        for aview in collectionViewCell!.contentView.subviews &#123;</div><div class="line">            if aview.isKindOfClass(UITableView.self) &#123;</div><div class="line">                tableView = aview as! UITableView</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        //*******</div><div class="line">        </div><div class="line">        let indexPath = tableView.indexPathForRowAtPoint(location)</div><div class="line">        let cell = tableView.cellForRowAtIndexPath(indexPath!) as! HomeCell</div><div class="line">        </div><div class="line">        let detailListContrller = ListDetailViewController(listId: &quot;1872&quot;,transImage: cell.imgView.image!)</div><div class="line">        </div><div class="line">    </div><div class="line">        //预显示的尺寸</div><div class="line">        detailListContrller.preferredContentSize = CGSizeMake(SCREEN_WIDTH, 600)</div><div class="line">        //源尺寸</div><div class="line">        previewingContext.sourceRect = cell.frame</div><div class="line">        </div><div class="line">        return detailListContrller</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>②对即将预览的ViewController，做一些操作，比如<strong>隐藏tabbar，隐藏导航栏</strong>等等，然后显示出来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">func previewingContext(previewingContext: UIViewControllerPreviewing, commitViewController viewControllerToCommit: UIViewController) &#123;</div><div class="line">        showViewController(viewControllerToCommit, sender: self)</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>####广场-展示<br>设计思路如图:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-32d54cd4642191bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp4c3452b2.png"></p>
<p>######与首页相似，红色部分View是蓝色 mainCollectionView的headerView，红色View中又包含着一个collectionView</p>
<p>######下拉刷新控件： </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-99ce105df96fba14.gif?imageMogr2/auto-orient/strip" alt="下拉刷新控件.gif"><br>Tips:下拉刷新控件 使用SVPullToRefresh 框架，然后在它的文件中修改了一个方法，把自己想要出现的动图加了进去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (SVPullToRefreshArrow *)arrow &#123;</div><div class="line">    if(!_arrow) &#123;</div><div class="line">		_arrow = [[SVPullToRefreshArrow alloc]initWithFrame:CGRectMake(0, self.bounds.size.height-54, 22, 48)];</div><div class="line">        _arrow.backgroundColor = [UIColor clearColor];</div><div class="line">              //将框架自带的刷新箭头屏蔽掉</div><div class="line">//		[self addSubview:_arrow];</div><div class="line">        </div><div class="line">        //这一部分是我自定义显示的View</div><div class="line">        UIImageView *gifImgView = [[UIImageView alloc] initWithFrame:CGRectMake(0, self.bounds.size.height-54, 125, 125)];</div><div class="line">        self.clipsToBounds = YES;</div><div class="line">        gifImgView.backgroundColor = [UIColor whiteColor];</div><div class="line">        gifImgView.image = [UIImage sd_animatedGIFNamed:@&quot;refreshGif&quot;];</div><div class="line">        //设置刷新动图只在Loading状态下显示</div><div class="line">        [self setCustomView:gifImgView forState:SVPullToRefreshStateLoading];</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    return _arrow;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>####秀出自我<br>这一部分的实现思路比较简单<br>1.在appdelegate中，实现tabbarControllerDelegate方法,<code>shouldSelectViewController</code>中，判断每次点击的是不是ShowMeController,如果是,则返回false，然后在当前的控制器<code>viewController.presentViewController(ShowMeViewController, animated: true, completion: nil)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">func tabBarController(tabBarController: UITabBarController, shouldSelectViewController viewController: UIViewController) -&gt; Bool &#123;</div><div class="line">        </div><div class="line">        </div><div class="line">        let childArray = tabbarController.childViewControllers</div><div class="line">        let index = childArray.indexOf(viewController)</div><div class="line">        if index == 2 &#123;</div><div class="line">            print(&quot;Show me!&quot;)</div><div class="line">            presentShowMeViewController(viewController)</div><div class="line">            return false</div><div class="line">        &#125;else if index == 3 &#123;</div><div class="line">            //点击 &apos;消息中心&apos; 延迟5s 后发出通知</div><div class="line">            //模拟网络刷新</div><div class="line">            viewController.tabBarItem.title = nil</div><div class="line">            postNotificationCenter(tabbarController.viewControllers!)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        return true</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>2.对于调用照相机的方法，首先判断有没有摄像头<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if UIImagePickerController.isSourceTypeAvailable(UIImagePickerControllerSourceType.Camera) &#123;</div><div class="line">            imagePicker.sourceType = UIImagePickerControllerSourceType.Camera</div><div class="line">            presentViewController(imagePicker, animated: true, completion: nil)</div><div class="line">        &#125;else &#123;</div><div class="line">            TipView.showMessage(&quot;骚年，找个有摄像头的手机吧。。&quot;)</div><div class="line">        &#125;</div></pre></td></tr></table></figure></p>
<p>然后viewController中添加代理 <code>UIImagePickerControllerDelegate,UINavigationControllerDelegate</code><br>在代理方法中可以获取到刚拍好的图片进行处理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">func imagePickerController(picker: UIImagePickerController, didFinishPickingImage image: UIImage, editingInfo: [String : AnyObject]?) &#123;</div><div class="line">        dispatch_async(dispatch_get_main_queue()) &#123; () -&gt; Void in</div><div class="line">            picker.dismissViewControllerAnimated(true, completion: nil)</div><div class="line">            self.topView.headerImage = image</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>####消息这一部分就很少东西了，因为我没有粉丝，没有消息😂，<br>为了模拟后台发送消息，在tabBarController的”shouldSelectViewController”中，当点击该控制器时，appdelegate发出通知，MessageViewController中接收通知，提示用户收到消息<br><code>//接受 模拟后台的推送、、、、
        NSNotificationCenter.defaultCenter().addObserver(self, selector: &quot;hasNewMessage&quot;, name: UserHasNewMessage, object: nil)</code></p>
<p>收到通知以后执行的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">func hasNewMessage()&#123;</div><div class="line">        print(&quot;收到通知了。&quot;)</div><div class="line">        TipView.showMessage(&quot;您有新的消息。但是你看不见😜&quot;)</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>####个人中心<br>这一部分设计思路与广场类似，也都是上面是HeaderView，下面是UICollectionView,不同的是个人中心最上面有一个背景图片，会随着collectionView的contentOffSet变化而放大<br>设计思路：<br><img src="http://upload-images.jianshu.io/upload_images/1299512-c373856c19d81113.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp2ae3bf03.png"></p>
<p>1.黄色View为 UIImageView，处于整个View的下层，collectionView和它的headerView的<code>backgroundColor = UIColor.clearColor()</code><br>最后在<code>func scrollViewDidScroll(scrollView: UIScrollView)</code>中调整 backImageView的<code>transform</code>属性即可<br>2.关于停靠问题，<br><img src="http://upload-images.jianshu.io/upload_images/1299512-5d605f459c2474c4.gif?imageMogr2/auto-orient/strip" alt="停靠问题.gif"><br>上图<br><img src="http://upload-images.jianshu.io/upload_images/1299512-baff52f142491aee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp19a4b2b9.png"><br>,姑且叫它<code>titleView</code>, titleView滚到设定位置时会停靠到导航栏底下，思路如下：</p>
<ol>
<li>titleView是添加到headerView中的，在<code>scrollViewDidScroll</code>方法中，监听collectionView的<code>contentOffset.y</code>的变化，当titleView到达设定的位置时，<code>titleView.removeFromSuperview()</code>,然后计算frame，将其添加到View上，这样就做除了停靠的效果，这样做比较简单<br>😥:  刚开始我单独将titleView添加到view上，collectionView滑动时还得一直更改<code>titleView.frame</code></li>
</ol>
<p>##聊聊感想哈<br>其实从OC转向Swift非常简单，这个项目不难，很适合从OC转向swift，或swift初学者。<br>少年也是第一次发布自己的项目，忘老鸟轻拍，新手共勉,有什么问题或bug联系我哈，欢迎来<a href="https://github.com/jiachenmu/Swift-BanTang" target="_blank" rel="external">我的GitHub</a>上赏个Star🌟</p>
<p>##GitHub 代码下载地址<br><a href="https://github.com/jiachenmu/Swift-BanTang.git" target="_blank" rel="external">代码下载地址,给个star再走🙏</a><br><strong>直接打开运行工程</strong><br>￼<img src="http://upload-images.jianshu.io/upload_images/1299512-d0b3d3c1fcd7ed7a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp1cbb03b9.png"></p>
<p>##收到有童鞋反应说，会遇到这样的Bug导致无法运行<br><img src="http://upload-images.jianshu.io/upload_images/1299512-767663cc96358060.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp788532b0.png"></p>
<p>Tips：由于GitHub上传的问题，解决办法如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-ff192623db0d0fd8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp44a0f1ff.png"></p>
<p>###项目编写中用的切图、标注、及本地数据在我的百度云</p>
<p><a href="http://pan.baidu.com/s/1dDZYetV" target="_blank" rel="external">切图、数据下载地址-ManoBpp的百度云</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift2-0-高仿App-半塘/">Swift2.0 高仿App 半塘</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iOS，如何模仿一个App" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/04/iOS，如何模仿一个App/" class="article-date">
      <time datetime="2016-03-04T02:42:00.000Z" itemprop="datePublished">2016-03-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/04/iOS，如何模仿一个App/">iOS，如何模仿一个App</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>##前言<br>作为一个IOS程序员，闲的时候也想自己做一个app练练手，又苦于没有UI设计，也没有好的idea，所以只能先模仿别人的App了，但是也会遇到以下问题<br><strong><br>①不知道怎么入手？怎么设计
</strong><br><strong><br>②app中的素材、图标要自己找吗、没有UI妹子给你切图怎么办，
</strong><br><strong><br>③没有数据怎么办？假数据也不会做怎么办
</strong><br><strong><br>④编写程序中该注意些什么
</strong></p>
<p>###<strong> 以下就从上面的三点开始介绍</strong><br>Tips:一下均为我个人的见解，有疑问或者建议请告诉我<br>以我的高仿项目<a href="http://www.jianshu.com/p/7b57eb0c4abe" target="_blank" rel="external">半糖App</a>为例</p>
<p><strong>
</strong></p>
<p>###一、不知道怎么入手？怎么设计<br>首先，整体浏览一下官方的<a href="http://www.ibantang.com" target="_blank" rel="external">半糖App</a>,</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-d02348459fbb12d0.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="
![
![
![IMG_0095.PNG](http://upload-images.jianshu.io/upload_images/1299512-202a765f086ca351.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)](http://upload-images.jianshu.io/upload_images/1299512-fc3a2b9ccf1b9894.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)](http://upload-images.jianshu.io/upload_images/1299512-ca997e779c4318c4.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)"></p>
<p>上面几张图片分别对应的是 首页、广场、消息中心、个人中心，，rootViewController是 UITabBarController,以首页为例</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-69ab39b354c62f1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp696dc36e.png"><br>Tips:</p>
<ul>
<li>1 整体上分为 两大部分 headerView 和UICollectionView</li>
<li>2 每次点击标签 “最新” “热门”等，collectionView 都会滚动到对应标签的tableView中，<br><strong>collectionView结构上来看就是这样：</strong></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-1ec9970356f439fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp59d229d4.png"></p>
<p>也就是  tableview 添加到collectionViewCell.contentView中显示出来</p>
<p><em>*headerView的结构如下</em><br><img src="http://upload-images.jianshu.io/upload_images/1299512-19dd06f7a0b5f760.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp5b876e7d.png">*<br>这一部分组合的自由度较大，然后每个按钮都设置不同tag，然后所有按钮添加相同的方法，比如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (void)clickCenterWithTag:(UIButton *)sender&#123;</div><div class="line">  if(sender.tag == 按钮tag值)&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然也可以设置一个block回调，参数为按钮tag值，在ViewController中 给block赋值的时候，比如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">headerView.clickCenterBlock = ^(Int tag)&#123;</div><div class="line">  //在这里进行判断，tag等于多少，进行什么操作</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>还有通知、delegate等方法都可以，就不一一细说了。。</p>
<p>#####之后的页面没有太过于复杂的结构，对照首页，也可以一一将View剥离出来<br><strong>
</strong></p>
<p>###二、app中的素材、图标要自己找吗、没有UI妹子给你切图怎么办</p>
<p>######①  app中好多按钮的图标、背景图片哪里找<br><strong>大招</strong>：电脑上在iTunes中下载你要模仿的app，找到它的存储目录(具体方法百度。)<br><img src="http://upload-images.jianshu.io/upload_images/1299512-7593ba963100b291.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp09a816eb.png"><br>接着，把 后缀.ipa 改为.zip ,然后把 zip文件打开</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-88813da3b9ed3f1a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp062cdaed.png"><br>显示包内容后，可以看到大部分你所需要的素材图片了</p>
<p>######②  切图标注问题(切图我就不说了，我只会截图，ps什么的都不会)<br>手机安装你要模仿的app，然后截屏，把图片发到电脑上，然后安装<strong>Mark Man</strong>工具，</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-e6278fa083cfbac7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp1e090874.png"><br>，然后将图片拖到Mark Man中，</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-ff66476405710e99.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp1be40fe1.png"></p>
<p>然后就可以随心所欲地标注，取色等等<br><strong>
</strong></p>
<p>###三、没有数据怎么办？该怎么去抓包<br>没有数据有两个方法：<br>① 做假数据，数据写死，这个不是很现实，因为你要模仿的app肯定有图片，这么做假数据得到猴年马月。。。<br>② 抓包，其实过程不是很繁琐<br>下面讲一下抓包的过程：</p>
<h4 id="1-工具"><a href="#1-工具" class="headerlink" title="* 1 工具"></a>* 1 工具</h4><p><img src="http://upload-images.jianshu.io/upload_images/1299512-a5ea0ed9c0ba754c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp4f89f5bc.png"></p>
<p>Charles 百度上很多可以下载，试用版即可，不需要破解</p>
<p><strong>使用过程:</strong></p>
<p>######①将手机和电脑连上同一个wifi，打开抓包工具</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-e5025717b7666b80.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp1be62615.png"></p>
<p>######②打开半糖app<br><img src="http://upload-images.jianshu.io/upload_images/1299512-45f1dd3ca0742236.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp11e3e193.png"></p>
<p>抓到半糖app的数据，点进去如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-1092bf90c5678583.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp6226dd3d.png"><br>这就是半糖app的数据，如果没有你想要的，别急，你先浏览你要抓数据的页面，这时候会发现这个目录有新的数据返回，点进去可以看到<br><img src="http://upload-images.jianshu.io/upload_images/1299512-24e906d1350288ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp7a92a51b.png"></p>
<p>点击  JavaScript按钮可以看到原始的json数据</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-7f6120f56d33748f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp7e5e4b14.png">，<br>将json数据 拷贝到文件中存储起来，这就是本地数据</p>
<p>②下面说一下 <strong>如何解析数据</strong>，以swift为例，OC类似参考一下。<br>比如我们将刚刚的json存为 test.rtf(别问我为什么是rtf，因为mac上记事本只有这么一个,当然你也可以存为txt格式等)，然后把test.rtf拖到项目中来</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-c85e52b34db68ea9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp4554b12a.png"><br>上代码：<br>Tips: 在这里，我们首先要明白一点，字典即为对象的一种表现形式。<br>先把模型写好：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">class TopicModel: NSObject &#123;</div><div class="line">  //先写两个属性</div><div class="line">  var id: String?</div><div class="line">  var title: String?</div><div class="line"></div><div class="line">  //从json中读取数据 并给model赋值(以下为Swift代码，OC请参考)，封装成类方法更方便</div><div class="line">  class fun readDataFromJSON() -&gt; TopicModel&#123;</div><div class="line">    //创建返回的model </div><div class="line">    let topicModel = TopicModel()</div><div class="line">    //读取JSON文件</div><div class="line">    let path = NSBundle.mainBundle().pathForResource(&quot;test&quot;, ofType: &quot;rtf&quot;)</div><div class="line">    let nsData = NSData(contentsOfFile: path!)</div><div class="line">     /// json整体转换为字典</div><div class="line">     let Dict = ( try! NSJSONSerialization.JSONObjectWithData(nsData!, options:.AllowFragments) ) as! NSDictionary</div><div class="line"></div><div class="line">  //看上面的图片中，你要抓得数据处于 四层目录下，一步一步来</div><div class="line"></div><div class="line">  //先把 &quot;data&quot;从json文件中 剥离出来</div><div class="line">    let Data = Dict.objectForKey(&quot;data&quot;) as! NSDictionary</div><div class="line">  </div><div class="line">  //从Data 中把 &quot;topic&quot;数组剥离出来,由图片可以看到 topic是一个数组 ，存了好多个相同类型的数据</div><div class="line">    let topicData = Data.objectForKey(&quot;topic&quot;) as! NSArray</div><div class="line"></div><div class="line">  //topic数据已经获取，我们先将第一个元素剥离出来，</div><div class="line">  // 定义一个object对象,并转换为字典类型</div><div class="line">  let obj = topicData[0] as! NSDictionary</div><div class="line">    </div><div class="line">// 现在将obj字典的值 赋给 我们定义的topicModel</div><div class="line">  topicModel.id = obj.objectForKey(&quot;id&quot;) as? String</div><div class="line">  topicModel.title = obj.objectForKey(&quot;title&quot;) as? String</div><div class="line"></div><div class="line">    //end: 到现在 给model赋值就可以了，返回model即可</div><div class="line"></div><div class="line">  return topicModel</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在需要用到model的地方，直接调用 Topic.readFromJSON 就会返回你要的model</p>
<p><strong>现在看来，抓包并没有我们想象中的繁琐 </strong></p>
<p>###四、编写程序应该注意什么<br>Tips: 这一部分只是参照我的经验来看，如有建议或者意见请与我交流，望不吝赐教</p>
<p>#####<strong>① 代码尽量要复用，封装控件前看看是否几个控件相似，可以放到一起，比如：</strong></p>
<p>这个是 广场中的标签栏<br><img src="http://upload-images.jianshu.io/upload_images/1299512-6f0e6bcb53bfa569.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp154d38d0.png"></p>
<p>这个是个人中心的标签栏</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-bfbd47b136aaa47b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp05e7ce45.png"></p>
<p>这个是清单详情的标签栏</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-7af7cce080989029.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp69f75d0d.png"></p>
<p>三个控件有不相同的地方，比如标签中的分割线，上面的边框，字体大小，<strong>但是</strong>，控件中的所有逻辑都一样，这就够了，可以写一个控件，加一些参数，比如说 是否显示边框，frame大小，中间是否有分割线，这样做的话，封装一个控件就可以满足 整个app中类似的控件</p>
<p>#####<strong>② 方法，或者称之为函数，封装也尽量放到一起，比如</strong><br>app中有很多对图片进行的操作，诸如 放大，裁剪，加边框，可以这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//将 这些方法都封装为 类方法 ，OC中也就是 &quot;+&quot;方法</div><div class="line">class ImageOperationCenter: NSObejct &#123;</div><div class="line"></div><div class="line">    class func ScaleToFize(image: UIImage) -&gt; UIImage &#123;</div><div class="line">      //对图片进行裁剪处理，并返回</div><div class="line">    &#125;</div><div class="line">    class func MakeScale(image: UIImage,scale: CGFloat) -&gt; UIImage &#123;</div><div class="line">      //对图片进行放大处理，并返回</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Tips：如上，将对图片的处理方法，都放在 <code>ImageOperationCenter</code> 这个类中，调用的时候只需要像这样 <code>let image = ImageOperationCenter.MakeScale(源照片，放大倍数)</code>即可，用着也方便</p>
<p>#####<strong>③ 与第一点类似，很多相似的控件，Cell尽量复用</strong><br>诸如 <img src="http://upload-images.jianshu.io/upload_images/1299512-7af7cce080989029.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp69f75d0d.png"><br>半糖精选的cell  与 用户推荐的cell 类似，但是有不同的地方，而且用到的model也不同，这样我们就要重写两种cell吗，<strong>不需要</strong>，只要 “用户推荐”的cell 继承 “半糖精选” 的cell，重写里面的方法即可，省了好多功夫，所以写程序一定<strong>要在不损失质量的前提下</strong>怎么省事怎么来</p>
<p>######再来看一个例子。<br><img src="http://upload-images.jianshu.io/upload_images/1299512-6ddaca9337de3424.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp63efa8a5.png"></p>
<p>这个通常会将它作为<code>collectionView</code>处理，其实，只有8个button的情况下，将button封装为一个View即可，这样，<code>ViewController</code>中会<strong>少了一堆代理方法和一堆初始化collectionView方法</strong><br>这个也就因人而异吧，要灵活运用哦~</p>
<p>#####<strong>⑤ 其实看到一个页面要先把整个页面的结构确定好，不要写了一半才发现这样写好像太麻烦，或者这样写写不出来</strong><br>我在我的高仿半糖app中 首页就遇到了这样的问题，开始想着 用<code>UIScrollView</code>当做容器，里面添加<code>UITableView</code>显示内容，这样做未尝不可，但是考虑到复用的问题，可以用三个tableView完成复用，但是这样做过于麻烦，所以后来就用collectionView当做容器，将tableView 添加到collectionViewCell中显示出来，这样复用的问题就解决了</p>
<p>###写在后面的话<br>我的开发经验也不多，上面完全是我在做项目中自己的感悟和体会，有些可能会有问题，请参考即可</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS-模仿-App/">iOS 模仿 App</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 ManoBoo
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >访问量: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>