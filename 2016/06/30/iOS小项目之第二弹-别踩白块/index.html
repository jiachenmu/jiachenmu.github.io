<!DOCTYPE html>
          <head>
        <meta charset="utf-8">
            
            <title>
                iOS小项目之第二弹- 别踩白块 | ManoBoo的技术小窝
            </title>
            <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
            <meta name="theme-color" content="#4184f3">
            
            
            <link href="/favicon.ico" rel="icon"/>
            

            <link rel="stylesheet" href="/css/highlight.light.css">
            <link rel="stylesheet" href="/css/nav-icon.css">
            <link rel="stylesheet" href="/css/waves.min.css">
            <link rel="stylesheet" href="/css/jquery.tocify.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/nav-indicator.css">
            
  

  
            </meta>
        </meta>
    </head>
    <body>
        <header>
            <!-- cover image or sth. -->
        </header>
        <div id="main" class="m-scene">
            <div class="nav-wrapper" style="background-color:undefined">
    <div class="container">
        <nav>
            <div class="logo wave">
                <a href="/" id="logo">
                    ManoBoo的技术小窝
                </a>
            </div>
            <div class="nav-toggle-icon" >
                <div class="material-hamburger">
                    <span>
                    </span>
                    <span>
                    </span>
                    <span>
                    </span>
                </div>
            </div>
            <div class="menu-wrapper">
                <div class="nav-indicator">
                </div>
                <ul class="menus">
                    
                     
                        <li>
                            <a class="wave " href="/">
                                Home
                            </a>
                        </li>
                     
                        <li>
                            <a class="wave " href="/archives">
                                Archive
                            </a>
                        </li>
                     
                        <li>
                            <a class="wave " href="/about">
                                About
                            </a>
                        </li>
                     
                        <li>
                            <a class="wave no-smoothstate" href="/atom.xml">
                                RSS
                            </a>
                        </li>
                     
                    
                   
                </ul>
            </div>
        </nav>
    </div>
</div>
            <div class="container content">
                <div class="scene_element scene_element--fadein">
                    <div class="row">
    <div class="main">
        <article>
          
          <header class="post-header">
          
          </header>
          <h1 class="post-title">iOS小项目之第二弹- 别踩白块</h1>

          <section class="post-info">
            <span class="post-date">2016/6/30</span>
            
            
            <span class="post-tags">
              <ul class="post-tag-list"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/iOS小项目-App/">iOS小项目 App</a></li></ul>
            </span>
            
          </section>

          <section class="post-content">
            <p>#iOS-OC项目 别踩白块(Don’t Tap The White Tile)</p>
<hr>
<p>##写在前面的话</p>
<p>####①别踩白块游戏简介：</p>
<blockquote>
<p>《别踩白块儿 Don’t Tap The White Tile》，这就是这个游戏唯一的一个规则，我们只需要不断踩着黑色方块前进即可，很简单吧？谁都可以会玩，但并不是谁都能玩得很好噢，你呢？快来挑战看看吧！经典模式，以最快的速度到达终点。街机模式，你有能力得多少分就得多少分，没有任何限制，这也是最具挑战性的一个模式。限时模式，在30秒内看你能走几步。极速模式，没有最高速限制的街机模式, 挑战你的极限接力模式，规定时间内完成50块儿，然后会有更多时间去完成另外的50块儿。【复制于百度百科】</p>
</blockquote>
<p>如果你没玩过，没关系 ，上图看看<br><img src="http://upload-images.jianshu.io/upload_images/1299512-1c86ccf35a745617.gif?imageMogr2/auto-orient/strip" alt="别踩白块儿.gif"><br>意思就是：每行有四个按钮，黑色的按钮是正确的需要你点击的按钮，白色块点击后游戏失败，所以这个游戏就叫”别踩白块儿”😂，别问我我为什么这么机智。</p>
<p>####②写这个小游戏的目的</p>
<p>#####<strong>最重要 :  <strong>纯属好玩</strong></strong><br>我觉得做一件事情最大的推动力就是 <strong>兴趣</strong> <strong>兴趣</strong> <strong>兴趣</strong>。<br>看到好多游戏都是拿Unity3D、Cocos2D开发的，我就想 我用系统自带的一些东海也可以实现一些简单的平面2D动画呀，所以我试了试，所以就有了这篇简书。</p>
<p>#####<strong>电商之类的app不美观</strong><br>前面仿写过<a href="http://www.jianshu.com/p/7b57eb0c4abe" target="_blank" rel="external">半糖app</a>，公司也是电商的app，所以对于电商app无爱了，,,Ծ‸Ծ,,，都是 首页、分类、购物车、个人中心的套路，你懂的。相反我倒是更喜欢一些电商入口的APP，就比如半糖、美丽说、小红书之类的app，UI很美观，这是吸引我的地方。</p>
<hr>
<p>##项目整体的概括</p>
<p>####①开发周期：<br>工作闲暇之余累计有10天左右，最近一个半月在忙公司的项目，只好抽时间写啦</p>
<p>####②开发工具和语言：<br> 开发工具为Xcode7.3   语言为Objective-C<br>因为前面仿写半糖app的时候，好多朋友给我说不太懂swift，那我就写个OC的小项目</p>
<p>####③开发要点：<br><strong>游戏成功、失败的逻辑代码基于 <code>ReactiveCocoa</code> ,代码有详细的解释。</strong><br>音频管理、整体的UI搭建不难，难的是整体游戏逻辑的设计。</p>
<hr>
<p>##项目详细实现过程</p>
<p>####①首页，页面较为简单，主要介绍一下 UIButton与 <code>ReactiveCocoa</code>的结合使用</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-81e0e7253713d485.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp58f5a0f6.png"></p>
<p>–主要代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//开始游戏按钮</div><div class="line">    _startButton = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH/2, SCREEN_HEIGHT)];</div><div class="line">    _startButton.backgroundColor = [UIColor blackColor];</div><div class="line">    [_startButton setTitle:@&quot;开始游戏&quot; forState:UIControlStateNormal];</div><div class="line">    [_startButton setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];</div><div class="line">    WeakSelf;</div><div class="line">    [[_startButton rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) &#123;</div><div class="line">        [weakSelf buttonHideAnimation];</div><div class="line">        [weakSelf  presentViewController:[[GameSceneViewController alloc] init] animated:false completion:^&#123;</div><div class="line">            //弹出游戏窗体后 暂停BGM</div><div class="line">            [SoundPlayer pauseBGM];</div><div class="line">        &#125;];</div><div class="line">        NSLog(@&quot; start game :)&quot;);</div><div class="line">    &#125;];</div><div class="line">    [self.view addSubview:_startButton];</div></pre></td></tr></table></figure></p>
<p>解释：<code>[_startButton rac_signalForControlEvents:UIControlEventTouchUpInside]</code>返回一个 <code>RACSignal</code>,可以理解为 一个信号，后面 <code>subscribeNext:^(id x) {}</code> 意思就是 接受到这个信号所做的操作。从字面意思上可以理解为，前者当你点击按钮，触发<code>UIControlEventTouchUpInside</code>事件的时候 ，发出一个信号，后者是接受到这个信号，你要干什么，由你决定。</p>
<p>####②游戏页面view，</p>
<p> #####倒计时动画介绍<br>上图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-76ac222f93784caa.gif?imageMogr2/auto-orient/strip" alt="倒计时动画.gif"><br>—-构成：view背景为黑色，中间添加了一个label，显示当前的数字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">*  倒计时 anim ......3 2 1 动画</div><div class="line">*</div><div class="line">*  @param anim          anim 变化的数字初始值</div><div class="line">*  @param completeBlock 动画结束后的操作</div><div class="line">*/</div><div class="line">- (void)showWithAnimNum:(NSInteger)anim CompleteBlock:(CompleteBlock)completeBlock;</div></pre></td></tr></table></figure>
<p>—-实现思路： 要做的从给定的参数 <code>anim</code>  递减到 0  之后结束动画，然后执行<code>completeBlock</code><br>，我是这样写一个类似于递归的动画：<br>①整体动画可以分为很多个，单个数字，做缩放和透明度改变的动画组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//返回一个 动画group</div><div class="line">- (CAAnimationGroup *)animationGroup &#123;</div><div class="line">    //缩放</div><div class="line">    CABasicAnimation *animation1 = [CABasicAnimation animation];</div><div class="line">    [animation1 setKeyPath:@&quot;transform.scale&quot;];</div><div class="line">    [animation1 setFromValue:@1.0];</div><div class="line">    [animation1 setToValue:@4.0];</div><div class="line">    [animation1 setDuration:1.0];</div><div class="line">    //改变透明度</div><div class="line">    CABasicAnimation *animation2 = [CABasicAnimation animation];</div><div class="line">    [animation2 setKeyPath:@&quot;alpha&quot;];</div><div class="line">    [animation2 setFromValue:@1.0];</div><div class="line">    [animation2 setToValue:@0.3];</div><div class="line">    [animation2 setDuration:1.0];</div><div class="line">    </div><div class="line">    </div><div class="line">    CAAnimationGroup *animGroup = [[CAAnimationGroup alloc] init];</div><div class="line">    animGroup.animations = [NSArray arrayWithObjects:animation1,animation2, nil];</div><div class="line">    [animGroup setDuration:1.0];</div><div class="line">    [animGroup setDelegate:self];</div><div class="line">    return animGroup;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>@用一个参数控制整体的动画的继续和停止，就是<code>_animIndex</code><br>每一个动画group执行完毕后，在 <code>- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag</code> 中进行<code>_animIndex--</code>，并且添加下一组动画，看代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// - MARK: Animation Delegate</div><div class="line">- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag &#123;</div><div class="line">    if (flag &amp;&amp; _animIndex &gt; 0) &#123;</div><div class="line">        _animIndex--;</div><div class="line">        _animLabel.text = [NSString stringWithFormat:@&quot;%ld&quot;,(long)_animIndex];</div><div class="line">        [_animLabel.layer addAnimation:[self animationGroup] forKey:nil];</div><div class="line">    &#125;</div><div class="line">    //动画执行完毕后 执行的操作</div><div class="line">    if (_animIndex == 0) &#123;</div><div class="line">        if (_completeBlock != nil) &#123;</div><div class="line">            //延迟0.4s之后 再开始游戏 防止游戏开始太快 user接受不了</div><div class="line">            self.hidden = true;</div><div class="line">            WeakSelf;</div><div class="line">            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.4 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">                _completeBlock();</div><div class="line">                [weakSelf.animLabel.layer removeAllAnimations];</div><div class="line">                weakSelf.hidden = false;</div><div class="line">                [weakSelf removeFromSuperview];</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> #####游戏界面如何搭建<br>①首页整体界面搭建<br><img src="http://upload-images.jianshu.io/upload_images/1299512-23020b7609d725bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="B7A2A5EB-B936-4ABD-BF2A-F6135389EC0C.png"><br>界面中每一个被我框起来的都是我封装的 <code>GameSceneView</code>,当然我们不能在每一个<code>GameSceneView</code>那如何实现’’重用’呢’<br><strong>实现思路：</strong><br>①计算你的屏幕中需要多少个<code>gameScene</code>，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// - 1: 先计算出 屏幕中需要多少个 scene</div><div class="line">    _sceneCount = ceil(SCREEN_HEIGHT / WhiteBlockHeight) + 1;</div></pre></td></tr></table></figure></p>
<p>②创建与之等同数量的scene<br><code>_frameArray</code>存储的是 scene创建时的初始frame,便于点击错误时，直接恢复到初始的frame<br><code>_operateArray</code>将创建好的scene集中到一起，便于管理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[_frameArray addObject:[NSValue valueWithCGRect:scene.frame]];</div><div class="line">[_operateArray addObject:scene];</div></pre></td></tr></table></figure></p>
<p>屏幕上所有的 <code>scene</code>都是向下滚动的，每次滚动判断是否超出屏幕，当用户点击正确、scene漂移到屏幕外的时候，再更新<code>scene</code>的<code>frame</code>，这个scene将被安排到最后一个<code>scene</code>的后面，上代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (void)viewWillAppear:(BOOL)animated &#123;</div><div class="line">    [super viewWillAppear:animated];</div><div class="line">    </div><div class="line">    //用 CADisplayLink 进行刷新 频率更快，动画效果不会卡顿</div><div class="line">    disPlayLink = [CADisplayLink displayLinkWithTarget:self selector:@selector(startScroll)];</div><div class="line">    </div><div class="line">    //先执行 3 2 1 这样的动画</div><div class="line">    [[StartAnimView shareInstance] showWithAnimNum:3 CompleteBlock:^&#123;</div><div class="line">        [disPlayLink addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSRunLoopCommonModes];</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>disPlayLink一直在调用 <code>- (void)startScroll</code>这个方法，刷新界面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">//开始滚动</div><div class="line">- (void)startScroll &#123;</div><div class="line">    WeakSelf;</div><div class="line">    </div><div class="line">    [_operateArray enumerateObjectsUsingBlock:^(id  _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</div><div class="line">        //</div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">            GameSceneView *scene = (GameSceneView *)obj;</div><div class="line">            CGRect frame = scene.frame;</div><div class="line">            frame.origin.y += _gameSpeed * 2.0;</div><div class="line">            if (!*stop) &#123;</div><div class="line">                scene.frame = frame;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            //  用户点击超时没有点击</div><div class="line">            if ( scene.frame.origin.y &gt;= SCREEN_HEIGHT &amp;&amp; scene.completeType == CompleteTypeNotClick)</div><div class="line">            &#123;</div><div class="line">                //停止刷新</div><div class="line">                [disPlayLink invalidate];</div><div class="line">                *stop = false;</div><div class="line">                </div><div class="line">                //弹出失败页面</div><div class="line">                [weakSelf resetGame];</div><div class="line">        </div><div class="line">            &#125;else if( scene.frame.origin.y &gt; SCREEN_HEIGHT &amp;&amp; scene.completeType == CompleteTypeVictory)&#123;</div><div class="line">                // 用户点击成功  计算新的frame</div><div class="line">                scene.frame = [weakSelf calculateNewFrameWithTag:scene.tag];</div><div class="line">                [scene reSet];</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>点击正确之后 计算该 <code>scene</code>新的frame<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//点击正确之后 将超出屏幕的scene 改变frame ，让玩家感觉一直有新scene的出来</div><div class="line">- (CGRect)calculateNewFrameWithTag: (NSInteger )tag &#123;</div><div class="line">    tag = tag == 0 ? _sceneCount - 1 : tag - 1;</div><div class="line">    </div><div class="line">    GameSceneView *scene = (GameSceneView *)[_operateArray objectAtIndex:tag];</div><div class="line">    CGRect frame = scene.frame;</div><div class="line">    frame.origin.y -= WhiteBlockHeight;</div><div class="line">    return frame;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这一部分用图很好解释：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-4e87160e38bfa764.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tmp13f239f2.png"><br>红色框为屏幕范围， 第0个<code>scene</code>超出屏幕后，新的位置即在 第4个<code>scene</code>的后面</p>
<h5 id="GameSceneView-的构建"><a href="#GameSceneView-的构建" class="headerlink" title="GameSceneView 的构建"></a>GameSceneView 的构建</h5><p>这一部分有一个小遗憾，应该将每行的button数量写成 参数，不应该写成4😀<br>每个button通过  button.layer的borderColor 和 borderWidth属性设置边框，所以显的有点粗糙。<br>主要代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">// - MARK: private method</div><div class="line">//快速构建button</div><div class="line">- (UIButton *)quickCreateButtonWithFrame:(CGRect)frame&#123;</div><div class="line">    UIButton *btn = [[UIButton alloc] initWithFrame:frame];</div><div class="line">    </div><div class="line">    btn.selected = false;</div><div class="line">    btn.layer.borderColor = [UIColor blackColor].CGColor;</div><div class="line">    btn.layer.borderWidth = 0.5;</div><div class="line">    btn.backgroundColor = [UIColor whiteColor];</div><div class="line"></div><div class="line">    WeakSelf;</div><div class="line">    [[[btn rac_signalForControlEvents:UIControlEventTouchUpInside]</div><div class="line">      map:^id(id value) &#123;</div><div class="line">          if(!weakSelf.isHasOtherSelected &amp;&amp; weakSelf.goalIndex == btn.tag)&#123;</div><div class="line">              // 没人点击 and 点击按钮为目标按钮 -&gt; click正确</div><div class="line">              btn.selected = false;</div><div class="line">              weakSelf.isHasOtherSelected = true;</div><div class="line">              weakSelf.completeType = CompleteTypeVictory;</div><div class="line">//              [SoundPlayer playWithMusicName:_effect];</div><div class="line">              weakSelf.clickBlock(CompleteTypeVictory);</div><div class="line">              return [UIColor whiteColor];</div><div class="line">          &#125;else if(!weakSelf.isHasOtherSelected &amp;&amp; weakSelf.goalIndex != btn.tag) &#123;</div><div class="line">              //点击btn 不是 目标 -&gt; click错误</div><div class="line">              weakSelf.completeType = CompleteTypeFailure;</div><div class="line">              weakSelf.isHasOtherSelected = true;</div><div class="line">//              [SoundPlayer playWithMusicName:ErrorEffect];</div><div class="line">              //点击错误之后 将正确的btn 执行动画</div><div class="line">              [weakSelf clickButtonFailureWithButton:btn];</div><div class="line">              return [UIColor orangeColor];</div><div class="line">          &#125;</div><div class="line">          return [UIColor whiteColor];</div><div class="line">          </div><div class="line">    &#125; ]subscribeNext:^(UIColor *color) &#123;</div><div class="line">        btn.backgroundColor = color;</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    return btn;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>解释一下：<br><strong>对于其中<code>ReactiveCocoa</code>的解释</strong><br><code>[btn rac_signalForControlEvents:UIControlEventTouchUpInside]</code>就是当你点击button的时候 会发出一个信号，<code>map:^id(id value) { ........}</code>是接受到该信号之后，你做的一些操作，返回一个value对象 ，<code>subscribeNext:^(id value) {.......}</code> 就是 对于接受到的<code>value</code>做的一些操作</p>
<p>用一个比喻来说，<code>[btn rac_signalForControlEvents:UIControlEventTouchUpInside]</code> 就是水源，<code>map:^id(id value) { ........}</code>就是农夫山泉加工厂，<code>subscribeNext:^(id value) {.......}</code>就是水送到你手里了，你要干什么，洗脸洗脚喝掉随便你。。</p>
<p><strong>对于游戏逻辑的解释：</strong><br>①<code>isHasOtherSelected</code>这个bool类型的变量 ：<br>true代表已经有一个button被点击  false代表没有button被点击<br>②根据点击成功与否,返回完成状态completeType<br>点击成功：<code>weakSelf.clickBlock(CompleteTypeVictory);</code><br>点击失败：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//点击错误之后  将失败的btn 闪烁下</div><div class="line">              [weakSelf clickButtonFailureWithButton:btn];</div></pre></td></tr></table></figure></p>
<p>button闪烁动画如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//点击错误 让点错的button 闪烁</div><div class="line">- (void)clickButtonFailureWithButton:(UIButton *)sender&#123;</div><div class="line">    </div><div class="line">    CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;opacity&quot;];//必须写opacity才行。</div><div class="line">    animation.fromValue = [NSNumber numberWithFloat:1.0f];</div><div class="line">    animation.toValue = [NSNumber numberWithFloat:0.0f];//这是透明度。</div><div class="line">    animation.autoreverses = YES;</div><div class="line">    animation.duration = 0.2;</div><div class="line">    animation.repeatCount = 4;</div><div class="line">    animation.removedOnCompletion = NO;</div><div class="line">    animation.fillMode = kCAFillModeForwards;</div><div class="line">    animation.timingFunction=[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];///渐进动画</div><div class="line">    [animation setDelegate:self];</div><div class="line">    [sender.layer addAnimation:animation forKey:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//闪烁完毕后 返回失败状态</div><div class="line">- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag &#123;</div><div class="line">    if (flag) &#123;</div><div class="line">        self.clickBlock(CompleteTypeFailure);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="音频处理、"><a href="#音频处理、" class="headerlink" title="音频处理、"></a>音频处理、</h5><p><code>SoundPlayer</code>这个类负责播放音频,调用<code>AVAudioPlayer</code>来播放音频<br>有三个方法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//按钮点击时播放的声音</div><div class="line">+ (void)playWithMusicName: (NSString *)fileName;</div><div class="line"></div><div class="line">//播放背景音乐</div><div class="line">+ (void)playBackgroundMusicWithName: (NSString *)fileName;</div><div class="line"></div><div class="line">//暂停背景音乐</div><div class="line">+ (void)pauseBGM;</div></pre></td></tr></table></figure></p>
<p><strong>关于点击音效的处理</strong><br>我有两个方案，都在代码里面<br>①点击按钮时，按点击次数来播放对应的声音：<br>具体实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">if (type == CompleteTypeVictory) &#123;</div><div class="line">        //点击成功  播放相应的 music</div><div class="line">        if (_clickIndex &gt; 213) &#123;</div><div class="line">            _clickIndex = (NSInteger)_clickIndex % 213;</div><div class="line">        &#125;</div><div class="line">        NSString *fileName = [NSString stringWithFormat:@&quot;C-%ld&quot;,_clickIndex];</div><div class="line">        if (_clickIndex &lt;= 9) &#123;</div><div class="line">            fileName = [NSString stringWithFormat:@&quot;C-0%ld&quot;,_clickIndex];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        [SoundPlayer playWithMusicName:fileName];</div><div class="line">        // 更新当前分数</div><div class="line">        _currentScore += 1.0;</div><div class="line">        // 根据当前分数 计算白块移动速度</div><div class="line">        [self updateGameSpeed];</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><strong>关于音频的来源</strong>：我将 <em>马克西姆</em> 的<strong>克罗地亚狂想曲</strong>分成了每个部分为1s的片段,大概200多个片段<br>这一部分有个<strong>疑问</strong>:声音文件一般不是分为左右声道吗，我将其中一个声道抽离出来当做背景音乐，另一个声道文件分成若干分，当按钮点击时播放是不是更好？懂电子音频处理的朋友出来回答下呗。</p>
<p>##项目感想<br>①其实复杂动画也是 “缩放” “旋转” “改变透明度” “移动”等一些基础动画的组合，下次遇到动画的时候可以试着将动画进行分解，这样就会减小实现的难度，<br>②尽量将代码写的清晰易懂，不忙的时候多回去review代码，就可以发现当初代码的一些不合理的逻辑，这样才会进步，这些天回去将我的<a href="http://www.jianshu.com/p/7b57eb0c4abe" target="_blank" rel="external">高仿半糖app</a> review下，古人老话，<strong>温故而知新 可以为师矣</strong><br>③学习之路，<strong>任重而道远，路漫漫其修远兮，吾将上下而求索</strong></p>
<p>##Github项目下载地址<br><strong>温馨提示：</strong>app启动后 会有背景音乐响起，so，你懂的，点击按钮也会播放 <strong>克罗地亚狂想曲</strong>的片段，运行时请请调低音量</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1299512-d22eeea07435f018.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="请运行.xcworkspace"><br><a href="https://github.com/jiachenmu/Don-tTapTheWhiteTile" target="_blank" rel="external">点击去我的Github下载</a></p>

          </section>
        </article>
        

       
        <div class="pager">
          
            <a class="post-prev pager-item" href="/2016/07/04/iOS-Reactive-Cocoa使用浅析/" >
              <strong class="article-nav-caption">Newer</strong>
              <p class="post-nav-title">iOS Reactive Cocoa使用浅析</p>
            </a>
          
          
            <a class="post-next pager-item" href="/2016/06/30/iOS小项目之第一弹-壁纸天气/">
              <strong class="article-nav-caption">Older</strong>
              <p class="post-nav-title">iOS小项目之第一弹- 壁纸天气</p>
            </a>
          
        </div>
        

         <!-- comments -->
        <div class="comment-section">
  
    

    <!-- 多说评论框 start -->
      <div class="ds-thread" data-thread-key="_posts/iOS小项目之第二弹-别踩白块.md" data-title="iOS小项目之第二弹- 别踩白块" data-url="http://yoursite.com/2016/06/30/iOS小项目之第二弹-别踩白块/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"wayouliu"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->

  


</div>

    </div>
    
</div>

                </div>
            </div>
        </div>
        <footer class="footer">
    <p>由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动，搭载<a href="https://github.com/wayou/hexo-theme-gstyle">gstyle</a>主题</p>
    <p>
        &copy; 2016 ManoBoo
    </p>
</footer>
<script src="/lib/jquery.js"></script>
<script src="/lib/waves.js"></script>
<script src="/lib/jquery-ui.js"></script>
<script src="/lib/jquery.tocify.js"></script>
<script src="/js/main.js"></script>

    </body>
</html>
